<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🧠 Diagnóstico Total - PROM Maestro Automatizador</title>
<style>
body{font-family:system-ui;background:#f5f7fa;margin:0;padding:1.5rem;color:#222;}
h1{color:#0d47a1;text-align:center;}
section{margin:1.5rem auto;padding:1rem;max-width:900px;border-radius:8px;}
.ok{background:#e8f7e8;border-left:6px solid #2e8b57;}
.warn{background:#fff9e6;border-left:6px solid #e6b800;}
.err{background:#ffe5e5;border-left:6px solid #c00;}
li{margin:6px 0;}
button{padding:0.6rem 1.2rem;margin:0.4rem;border:none;border-radius:6px;cursor:pointer;background:#1565c0;color:white;}
button:hover{background:#1976d2;}
.status{font-weight:bold;}
</style>
</head>
<body>

<h1>🧠 Diagnóstico Total - Sistema PROM</h1>

<section class="ok">
  <h2>📦 Módulos JavaScript</h2>
  <ul id="jsResults"></ul>
  <button onclick="testJS()">Comprobar JS</button>
</section>

<section class="ok">
  <h2>⚙️ Estructura del Proyecto</h2>
  <ul id="folders"></ul>
  <button onclick="testFolders()">Comprobar carpetas</button>
</section>

<section class="ok">
  <h2>🧾 Archivos de Configuración</h2>
  <ul id="configFiles"></ul>
  <button onclick="testConfig()">Verificar .env y requisitos</button>
</section>

<section class="ok">
  <h2>🎧 Recursos multimedia</h2>
  <ul id="mediaResults"></ul>
  <button onclick="testMedia()">Comprobar audios e imágenes</button>
</section>

<section class="ok">
  <h2>📍 GPS y ubicación</h2>
  <p id="gpsStatus" class="status">Esperando...</p>
  <button onclick="testGPS()">Probar GPS</button>
</section>

<script>
const jsFiles = [
  "js/constants.js","js/logger.js","js/config.js",
  "js/utils.js","js/funciones-mapa.js","js/eventos-usuario.js"
];

const folders = [
  "src/","data/","outputs/","logs/","tests/"
];

const configFiles = [
  "README.md","requirements.txt","env_example.txt",".env"
];

const mediaFiles = [
  "Av1_audio_esp/03 Av1 Pista 3 ESPAÑOL.mp3",
  "fotos_Av1/00_torres_de_serranos_back.jpg",
  "mapas/Av1_mapa.png"
];

// === TEST DE JS ===
async function testJS(){
  const ul=document.getElementById("jsResults");
  ul.innerHTML="";
  for(const f of jsFiles){
    const li=document.createElement("li");
    try{
      const r=await fetch(f,{cache:"no-store"});
      if(!r.ok) throw new Error();
      li.textContent="✅ "+f+" cargado correctamente";
      li.style.color="green";
    }catch(e){
      li.textContent="⚠️ "+f+" no encontrado o inaccesible";
      li.style.color="orange";
    }
    ul.appendChild(li);
  }
}

// === TEST DE CARPETAS ===
async function testFolders(){
  const ul=document.getElementById("folders");
  ul.innerHTML="";
  for(const folder of folders){
    const li=document.createElement("li");
    try{
      const r=await fetch(folder);
      if(!r.ok) throw new Error();
      li.textContent="✅ Carpeta '"+folder+"' accesible";
      li.style.color="green";
    }catch(e){
      li.textContent="⚠️ Carpeta '"+folder+"' no encontrada (verifica estructura)";
      li.style.color="orange";
    }
    ul.appendChild(li);
  }
}

// === TEST DE CONFIGURACIÓN ===
async function testConfig(){
  const ul=document.getElementById("configFiles");
  ul.innerHTML="";
  for(const f of configFiles){
    const li=document.createElement("li");
    try{
      const r=await fetch(f,{cache:"no-store"});
      if(!r.ok) throw new Error();
      li.textContent="✅ "+f+" disponible";
      li.style.color="green";
    }catch(e){
      li.textContent="⚠️ "+f+" no localizado";
      li.style.color="orange";
    }
    ul.appendChild(li);
  }
}

// === TEST MULTIMEDIA ===
async function testMedia(){
  const ul=document.getElementById("mediaResults");
  ul.innerHTML="";
  for(const f of mediaFiles){
    const li=document.createElement("li");
    try{
      const r=await fetch(f,{cache:"no-store"});
      if(!r.ok) throw new Error();
      li.textContent="✅ "+f+" accesible";
      li.style.color="green";
    }catch(e){
      li.textContent="⚠️ "+f+" no disponible o faltante";
      li.style.color="orange";
    }
    ul.appendChild(li);
  }
}

// === TEST GPS ===
function testGPS(){
  const status=document.getElementById("gpsStatus");
  if("geolocation" in navigator){
    navigator.geolocation.getCurrentPosition(
      pos=>{
        const {latitude,longitude}=pos.coords;
        status.textContent=`✅ GPS activo (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
        status.style.color="green";
      },
      err=>{
        status.textContent="⚠️ No se pudo obtener ubicación ("+err.message+")";
        status.style.color="orange";
      }
    );
  }else{
    status.textContent="❌ Este navegador no soporta geolocalización";
    status.style.color="red";
  }
}
</script>
</body>
</html>
