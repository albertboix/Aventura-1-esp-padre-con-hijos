<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Av1 - Coordenadas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    .camera-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
    }
    .photo-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1500;
    }
    .photo-overlay img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }
    .photo-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="camera-btn" onclick="showPhoto()">
    ðŸ“·
  </div>
  <div class="photo-overlay" id="photoOverlay">
    <div class="photo-close" onclick="hidePhoto()">âœ•</div>
    <img id="photoImage" src="fotos_Av1/00_torres_de_serranos_back.jpg" alt="Foto prÃ³xima parada" />
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').fitWorld();

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    const ruta = [
      [39.47876, -0.37626], [39.47943, -0.37636], [39.47959, -0.37583],
      [39.47939, -0.3752], [39.47866, -0.3747], [39.47785, -0.37485],
      [39.47768, -0.3749], [39.47656, -0.37529], [39.4766, -0.37473],
      [39.47609, -0.37449], [39.47594, -0.37474], [39.4762, -0.37412],
      [39.47611, -0.37478], [39.47603, -0.37433], [39.4755, -0.37436],
      [39.4756, -0.37466], [39.47533, -0.37563], [39.47514, -0.37494],
      [39.47447, -0.3754], [39.47212, -0.37676], [39.47056, -0.37677],
      [39.46971, -0.37693], [39.46795, -0.37701], [39.46722, -0.37702],
      [39.46709, -0.37595], [39.46714, -0.37498], [39.46753, -0.37511],
      [39.46942, -0.37559], [39.4699, -0.37573], [39.4703, -0.3759],
      [39.47039, -0.37505], [39.47061, -0.37408], [39.47119, -0.37423],
      [39.47214, -0.37446], [39.47276, -0.37467], [39.47311, -0.37589],
      [39.47261, -0.37654], [39.47265, -0.37725], [39.47377, -0.37832],
      [39.47425, -0.37895], [39.47426, -0.37862], [39.47459, -0.37868],
      [39.47444, -0.3779], [39.47521, -0.37766], [39.47611, -0.37741],
      [39.47663, -0.3773], [39.47668, -0.37671],
    ];

    const paradas = [
      { coord: [39.47876, -0.37626], nombre: 'Torres de Serranos', foto: 'fotos_Av1/00_torres_de_serranos_back.jpg' },
      { coord: [39.47959, -0.37583], nombre: 'Plaza del Carmen', foto: 'fotos_Av1/01_plaza_carmen.jpg' },
      { coord: [39.47785, -0.37485], nombre: 'Museo EtnolÃ³gico', foto: 'fotos_Av1/02_museo_etnologico.jpg' },
      { coord: [39.47656, -0.37529], nombre: 'IVAM', foto: '' },
      { coord: [39.47609, -0.37449], nombre: 'Calle Alta', foto: '' },
      { coord: [39.47594, -0.37474], nombre: 'Portal de la Valldigna', foto: '' },
      { coord: [39.4762, -0.37412], nombre: 'Calle Mare Vella', foto: '' },
      { coord: [39.47611, -0.37478], nombre: 'Parroquia', foto: '' },
      { coord: [39.4755, -0.37436], nombre: 'Muralla Ã¡rabe', foto: '' },
      { coord: [39.47056, -0.37677], nombre: 'Plaza Redonda', foto: '' },
      { coord: [39.46971, -0.37693], nombre: 'Lonja', foto: '' },
      { coord: [39.46722, -0.37702], nombre: 'Plaza Ayuntamiento', foto: '' },
      { coord: [39.46709, -0.37595], nombre: 'Calle San Vicente', foto: '' },
      { coord: [39.46753, -0.37511], nombre: 'San AgustÃ­n', foto: '' },
      { coord: [39.46942, -0.37559], nombre: 'Museo Fallero', foto: '' },
      { coord: [39.47061, -0.37408], nombre: 'Puerta de la Mar', foto: '' },
      { coord: [39.47276, -0.37467], nombre: 'Parque Turia', foto: '' },
      { coord: [39.47377, -0.37832], nombre: 'Palau', foto: '' },
      { coord: [39.47425, -0.37895], nombre: 'Puente de las Flores', foto: '' },
      { coord: [39.47426, -0.37862], nombre: 'Centro Cultural', foto: '' },
      { coord: [39.47444, -0.3779], nombre: 'Museo de Ciencias', foto: '' },
      { coord: [39.47611, -0.37741], nombre: 'HemisfÃ¨ric', foto: '' },
      { coord: [39.47663, -0.3773], nombre: 'Umbracle', foto: '' },
      { coord: [39.47668, -0.37671], nombre: 'OceanogrÃ fic', foto: '' },
    ];

    L.polyline(ruta, { color: 'blue', weight: 4 }).addTo(map);

    paradas.forEach(p => {
      const marker = L.marker(p.coord).addTo(map);
      marker.bindPopup(p.nombre);

      marker.on('click', () => {
        marker.openPopup();
        // Enviar mensaje al padre sobre la parada seleccionada
        window.parent.postMessage({ tipo: 'paradaSeleccionada', nombre: p.nombre }, '*');
      });
    });

    map.locate({ setView: true, watch: true });

    function onLocationFound(e) {
      const radius = e.accuracy / 2;
      L.marker(e.latlng).addTo(map).bindPopup("EstÃ¡s aquÃ­").openPopup();
    }
    map.on('locationfound', onLocationFound);

    let currentParada = 0;

    function showPhoto() {
      const parada = paradas[currentParada];
      const photoOverlay = document.getElementById('photoOverlay');
      const photoImage = document.getElementById('photoImage');

      if (parada && parada.foto) {
        photoImage.src = parada.foto;
      } else {
        photoImage.src = 'default.jpg';
      }

      photoOverlay.style.display = 'flex';
    }

    function hidePhoto() {
      document.getElementById('photoOverlay').style.display = 'none';
    }
  </script>
</body>
</html>
