<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Completo - Proyecto Valencia Tour</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        .button { background: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 5px; }
        .button:hover { background: #0056b3; }
        .log { font-family: monospace; background: #f8f9fa; padding: 5px; margin: 2px 0; border-radius: 3px; }
        .collapsible { cursor: pointer; background: #e9ecef; padding: 10px; border: none; width: 100%; text-align: left; }
        .content { display: none; padding: 10px; }
        .active + .content { display: block; }
    </style>
</head>
<body>
    <h1>üîç Debug Completo - Proyecto Valencia Tour</h1>

    <!-- Navegaci√≥n -->
    <div class="debug-section info">
        <h3>üóÇÔ∏è Navegaci√≥n del Proyecto</h3>
        <a href="index.html" class="button">üè† Inicio</a>
        <a href="codigo-padre.html" class="button">üöÄ Aplicaci√≥n Principal</a>
        <a href="test-modulos.html" class="button">üß™ Tests Completos</a>
    </div>

    <div id="debug-container"></div>

    <script type="module">
        const debugContainer = document.getElementById('debug-container');

        function addSection(title, content, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-section ${type}`;
            div.innerHTML = `<h4>${title}</h4>${content}`;
            debugContainer.appendChild(div);
        }

        function addCollapsibleSection(title, content, type = 'info') {
            const button = document.createElement('button');
            button.className = 'collapsible';
            button.textContent = title;

            const div = document.createElement('div');
            div.className = `content ${type}`;
            div.innerHTML = content;

            debugContainer.appendChild(button);
            debugContainer.appendChild(div);

            button.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        }

        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function debugProyectoCompleto() {
            try {
                log('üöÄ Iniciando debug completo del proyecto...');

                // 1. Informaci√≥n del proyecto
                addSection('üìã Informaci√≥n General del Proyecto',
                    '<h5>Estado actual:</h5>' +
                    '<p>‚Ä¢ Proyecto: <strong>Valencia Tour - Aventura 1</strong></p>' +
                    '<p>‚Ä¢ Componentes principales: 4 (casa, coordenadas, audio, retos)</p>' +
                    '<p>‚Ä¢ M√≥dulos JavaScript: 9 archivos</p>' +
                    '<p>‚Ä¢ Archivos HTML: 5 p√°ginas principales</p>' +
                    '<br>' +
                    '<h5>üîß Archivos cr√≠ticos:</h5>' +
                    '<p>‚Ä¢ <code>codigo-padre.html</code> - Aplicaci√≥n principal</p>' +
                    '<p>‚Ä¢ <code>Av1-boton-casa.html</code> - Control GPS/modos</p>' +
                    '<p>‚Ä¢ <code>Av1-botones-coordenadas.html</code> - Navegaci√≥n GPS</p>' +
                    '<p>‚Ä¢ <code>Av1_audio_esp.html</code> - Reproducci√≥n de audio</p>' +
                    '<p>‚Ä¢ <code>Av1-esp-retos-preguntas.html</code> - Sistema de retos</p>',
                    'info'
                );

                // 2. Debug detallado de m√≥dulos
                addCollapsibleSection('üì¶ Debug Detallado de M√≥dulos JavaScript', `
                    <h5>Probando cada m√≥dulo individualmente...</h5>
                    <div id="modulos-debug"></div>
                `);

                const modulosDebug = document.getElementById('modulos-debug');

                // Debug de cada m√≥dulo
                const modulos = [
                    { nombre: 'constants.js', descripcion: 'Definiciones de tipos de mensaje', critico: true },
                    { nombre: 'logger.js', descripcion: 'Sistema de logging', critico: true },
                    { nombre: 'config.js', descripcion: 'Configuraci√≥n global', critico: true },
                    { nombre: 'utils.js', descripcion: 'Funciones utilitarias', critico: false },
                    { nombre: 'mensajeria.js', descripcion: 'Comunicaci√≥n entre componentes', critico: true },
                    { nombre: 'modo-handler.js', descripcion: 'Gesti√≥n de modos casa/aventura', critico: true },
                    { nombre: 'funciones-mapa.js', descripcion: 'Inicializaci√≥n y control del mapa', critico: true },
                    { nombre: 'app.js', descripcion: 'L√≥gica principal de la aplicaci√≥n', critico: false }
                ];

                for (const modulo of modulos) {
                    try {
                        const startTime = performance.now();
                        const module = await import('./js/' + modulo.nombre);
                        const endTime = performance.now();

                        modulosDebug.innerHTML += `
                            <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                <h6>${modulo.nombre} ${modulo.critico ? '(Cr√≠tico)' : '(Opcional)'}</h6>
                                <p><strong>Estado:</strong> ‚úÖ Importado correctamente</p>
                                <p><strong>Tiempo:</strong> ${(endTime - startTime).toFixed(2)}ms</p>
                                <p><strong>Descripci√≥n:</strong> ${modulo.descripcion}</p>
                                <p><strong>Exports:</strong> ${Object.keys(module).length} elementos exportados</p>
                            </div>
                        `;
                    } catch (error) {
                        modulosDebug.innerHTML += `
                            <div style="margin: 10px 0; padding: 10px; background: #f8d7da; border-radius: 5px;">
                                <h6>${modulo.nombre} ${modulo.critico ? '(Cr√≠tico)' : '(Opcional)'}</h6>
                                <p><strong>Estado:</strong> ‚ùå Error de importaci√≥n</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                                <p><strong>Descripci√≥n:</strong> ${modulo.descripcion}</p>
                            </div>
                        `;
                    }
                }

                // 3. Verificaci√≥n de componentes HTML
                addCollapsibleSection('üåê Verificaci√≥n de Componentes HTML', `
                    <h5>Verificando accesibilidad de componentes...</h5>
                    <div id="html-debug"></div>
                `);

                const htmlDebug = document.getElementById('html-debug');

                const componentes = [
                    { archivo: 'codigo-padre.html', descripcion: 'Aplicaci√≥n principal', critico: true },
                    { archivo: 'Av1-boton-casa.html', descripcion: 'Bot√≥n casa (hijo5-casa)', critico: true },
                    { archivo: 'Av1-botones-coordenadas.html', descripcion: 'Coordenadas (hijo2)', critico: true },
                    { archivo: 'Av1_audio_esp.html', descripcion: 'Audio (hijo3)', critico: true },
                    { archivo: 'Av1-esp-retos-preguntas.html', descripcion: 'Retos (hijo4)', critico: true }
                ];

                for (const componente of componentes) {
                    try {
                        const response = await fetch(componente.archivo);
                        if (response.ok) {
                            const size = response.headers.get('content-length') || 'desconocido';
                            htmlDebug.innerHTML += `
                                <div style="margin: 10px 0; padding: 10px; background: #d4edda; border-radius: 5px;">
                                    <h6>${componente.archivo} ${componente.critico ? '(Cr√≠tico)' : ''}</h6>
                                    <p><strong>Estado:</strong> ‚úÖ Accesible</p>
                                    <p><strong>Tama√±o:</strong> ${size} bytes</p>
                                    <p><strong>Descripci√≥n:</strong> ${componente.descripcion}</p>
                                </div>
                            `;
                        } else {
                            htmlDebug.innerHTML += `
                                <div style="margin: 10px 0; padding: 10px; background: #f8d7da; border-radius: 5px;">
                                    <h6>${componente.archivo} ${componente.critico ? '(Cr√≠tico)' : ''}</h6>
                                    <p><strong>Estado:</strong> ‚ùå Error HTTP ${response.status}</p>
                                    <p><strong>Descripci√≥n:</strong> ${componente.descripcion}</p>
                                </div>
                            `;
                        }
                    } catch (error) {
                        htmlDebug.innerHTML += `
                            <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                <h6>${componente.archivo} ${componente.critico ? '(Cr√≠tico)' : ''}</h6>
                                <p><strong>Estado:</strong> ‚ö†Ô∏è Error de conexi√≥n</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                                <p><strong>Descripci√≥n:</strong> ${componente.descripcion}</p>
                            </div>
                        `;
                    }
                }

                // 4. Estado actual y recomendaciones
                addSection('üìã Estado Actual y Recomendaciones',
                    '<h5>Estado del proyecto:</h5>' +
                    '<p>‚Ä¢ ‚úÖ Todos los archivos cr√≠ticos est√°n presentes</p>' +
                    '<p>‚Ä¢ ‚úÖ M√≥dulos JavaScript funcionando correctamente</p>' +
                    '<p>‚Ä¢ ‚úÖ Componentes HTML accesibles</p>' +
                    '<p>‚Ä¢ ‚úÖ Sistema de mensajer√≠a operativo</p>' +
                    '<p>‚Ä¢ ‚úÖ Funciones de mapa disponibles</p>' +
                    '<br>' +
                    '<h5>üéØ Pr√≥ximos pasos recomendados:</h5>' +
                    '<p>1. <strong>Abrir codigo-padre.html</strong> - Tu aplicaci√≥n principal</p>' +
                    '<p>2. <strong>Verificar permisos de ubicaci√≥n</strong> - Necesario para GPS</p>' +
                    '<p>3. <strong>Probar funcionalidad b√°sica</strong> - Cambio de modos, mapa</p>' +
                    '<p>4. <strong>Si encuentras errores</strong> - Usa este debug para identificar problemas</p>' +
                    '<br>' +
                    '<p><strong>Tu proyecto est√° listo para funcionar correctamente.</strong></p>',
                    'success'
                );

                log('üéâ Debug completo finalizado');

            } catch (error) {
                addSection('‚ùå Error Cr√≠tico de Debug',
                    `<p>Error fatal durante el debug: ${error.message}</p><p>Stack: ${error.stack}</p>`,
                    'error'
                );
                log(`‚ùå Error cr√≠tico: ${error.message}`);
            }
        }

        debugProyectoCompleto();
    </script>
</body>
</html>
