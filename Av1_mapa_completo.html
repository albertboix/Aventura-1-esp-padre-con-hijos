<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruta completa con paradas y waypoints</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
  </style>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    const rutaCompleta = [
      { tipo: "parada", nombre: "Torres de Serranos (start)", lat: 39.47876, lng: -0.37626 },
      { tipo: "waypoint", lat: 39.47943, lng: -0.37636 },
      { tipo: "parada", nombre: "Puente de Serranos – Plaza de la crida", lat: 39.47959, lng: -0.37583 },
      { tipo: "waypoint", lat: 39.47939, lng: -0.3752 },
      { tipo: "waypoint", lat: 39.47866, lng: -0.3747 },
      { tipo: "parada", nombre: "Cortes Valencianas (Palacio de los Borgia)", lat: 39.47785, lng: -0.37485 },
      { tipo: "waypoint", lat: 39.47768, lng: -0.3749 },
      { tipo: "parada", nombre: "Plaza de la Virgen", lat: 39.47656, lng: -0.37529 },
      { tipo: "waypoint", lat: 39.4766, lng: -0.37473 },
      { tipo: "parada", nombre: "Plaza de la Almoína", lat: 39.47609, lng: -0.37449 },
      { tipo: "parada", nombre: "Catedral de València", lat: 39.47594, lng: -0.37474 },
      { tipo: "parada", nombre: "Plaza decimo Juno Bruto (Museo Arqueológico de la Almoína)", lat: 39.4762, lng: -0.37412 },
      { tipo: "parada", nombre: "Basílica de València", lat: 39.47611, lng: -0.37478 },
      { tipo: "waypoint", lat: 39.47603, lng: -0.37433 },
      { tipo: "parada", nombre: "Palacio Arzobispal", lat: 39.4755, lng: -0.37436 },
      { tipo: "waypoint", lat: 39.4756, lng: -0.37466 },
      { tipo: "waypoint", lat: 39.47533, lng: -0.37563 },
      { tipo: "waypoint", lat: 39.47514, lng: -0.37494 },
      { tipo: "waypoint", lat: 39.47447, lng: -0.3754 },
      { tipo: "waypoint", lat: 39.47212, lng: -0.37676 },
      { tipo: "parada", nombre: "Plaza del Ayuntamiento", lat: 39.47056, lng: -0.37677 },
      { tipo: "parada", nombre: "Edificio del Ayuntamiento de València", lat: 39.46971, lng: -0.37693 },
      { tipo: "waypoint", lat: 39.46795, lng: -0.37701 },
      { tipo: "parada", nombre: "Estación de Ferrocarril (Estación del Norte)", lat: 39.46722, lng: -0.37702 },
      { tipo: "parada", nombre: "Plaza de Toros de València", lat: 39.46709, lng: -0.37595 },
      { tipo: "waypoint", lat: 39.46714, lng: -0.37498 },
      { tipo: "parada", nombre: "Casa estilo Árabe", lat: 39.46753, lng: -0.37511 },
      { tipo: "parada", nombre: "Palacio de Comunicaciones (Correos)", lat: 39.46942, lng: -0.37559 },
      { tipo: "waypoint", lat: 39.4699, lng: -0.37573 },
      { tipo: "waypoint", lat: 39.4703, lng: -0.3759 },
      { tipo: "waypoint", lat: 39.47039, lng: -0.37505 },
      { tipo: "parada", nombre: "Antigua sede del Banco de València", lat: 39.47061, lng: -0.37408 },
      { tipo: "waypoint", lat: 39.47119, lng: -0.37423 },
      { tipo: "waypoint", lat: 39.47214, lng: -0.37446 },
      { tipo: "parada", nombre: "Palacio del Marqués de Dos Aguas (Museo Nacional de Crámica)", lat: 39.47276, lng: -0.37467 },
      { tipo: "waypoint", lat: 39.47311, lng: -0.37589 },
      { tipo: "waypoint", lat: 39.47261, lng: -0.37654 },
      { tipo: "waypoint", lat: 39.47265, lng: -0.37725 },
      { tipo: "parada", nombre: "Mercado Central", lat: 39.47377, lng: -0.37832 },
      { tipo: "parada", nombre: "San Juan del Mercado (Iglesia de los Santos Juanes)", lat: 39.47425, lng: -0.37895 },
      { tipo: "parada", nombre: "Lonja de València (Mercado de la Seda)", lat: 39.47426, lng: -0.37862 },
      { tipo: "waypoint", lat: 39.47459, lng: -0.37868 },
      { tipo: "parada", nombre: "Plaza del Doctor Collado", lat: 39.47444, lng: -0.3779 },
      { tipo: "waypoint", lat: 39.47521, lng: -0.37766 },
      { tipo: "parada", nombre: "Plaza del Negrito (Fuente del Negrito)", lat: 39.47611, lng: -0.37741 },
      { tipo: "parada", nombre: "Calle Caballeros", lat: 39.47663, lng: -0.3773 },
      { tipo: "parada", nombre: "Palacio de la Generalitat", lat: 39.47668, lng: -0.37671 },
      { tipo: "waypoint", lat: 39.47774, lng: -0.37671 }
    ];

    // Inicializar mapa en iframe
    const map = L.map('map').setView([39.476, -0.375], 15);

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Añadir marcadores para paradas
    rutaCompleta.forEach(punto => {
      if (punto.tipo === "parada") {
        L.marker([punto.lat, punto.lng]).addTo(map)
          .bindPopup(`<span style="font-size:16px;">${punto.nombre}</span>`);
      }
    });

    // Dibujar ruta completa
    const latlngs = rutaCompleta.map(p => [p.lat, p.lng]);
    const polyline = L.polyline(latlngs, {color: 'blue', weight: 4}).addTo(map);
    map.fitBounds(polyline.getBounds());

    // Enviar datos al código padre
    window.parent.postMessage({
      tipo: 'ruta-completa',
      paradas: rutaCompleta.filter(p => p.tipo === 'parada'),
      waypoints: rutaCompleta.filter(p => p.tipo === 'waypoint'),
      ruta: rutaCompleta
    }, '*');
  </script>
</body>
</html>
