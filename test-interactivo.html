<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🔍 Test Interactivo - Proyecto Valencia Tour</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<style>
body{font-family:system-ui;background:#f5f7fa;margin:0;padding:1.5rem;color:#222;}
h1{color:#1565c0;text-align:center;}
section{margin:1.5rem auto;padding:1rem;max-width:900px;border-radius:8px;}
.ok{background:#e8f7e8;border-left:6px solid #2e8b57;}
.warn{background:#fff9e6;border-left:6px solid #e6b800;}
.err{background:#ffe5e5;border-left:6px solid #c00;}
li{margin:6px 0;}
button{padding:0.5rem 1rem;margin:0.5rem;border:none;border-radius:6px;cursor:pointer;background:#1565c0;color:white;}
button:hover{background:#1976d2;}
#map{height:300px;margin-top:10px;border-radius:8px;}
audio{width:100%;margin-top:10px;}
.status{font-weight:bold;}
</style>
</head>
<body>
<h1>🔍 Test Interactivo - Proyecto Valencia Tour</h1>

<section id="files" class="ok">
  <h2>📦 Verificación de Archivos</h2>
  <ul id="fileResults"></ul>
  <button onclick="runFileTest()">Ejecutar Test de Archivos</button>
</section>

<section id="audio" class="ok">
  <h2>🎧 Prueba de Audio</h2>
  <audio id="testAudio" controls src="Av1_audio_esp/03 Av1 Pista 3 ESPAÑOL.mp3"></audio>
  <p id="audioStatus" class="status">Esperando reproducción...</p>
  <button onclick="testAudio()">Probar Audio</button>
</section>

<section id="mapSection" class="ok">
  <h2>🗺️ Prueba de Mapa</h2>
  <div id="map"></div>
  <p id="mapStatus" class="status">Mapa no inicializado</p>
  <button onclick="initMap()">Mostrar Mapa</button>
</section>

<section id="gps" class="ok">
  <h2>📍 Prueba de GPS</h2>
  <p id="gpsStatus" class="status">Esperando...</p>
  <button onclick="testGPS()">Probar Geolocalización</button>
</section>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// === TEST DE ARCHIVOS ===
const files = ["js/constants.js","js/config.js","js/logger.js","js/utils.js"];
async function runFileTest(){
  const ul = document.getElementById("fileResults");
  ul.innerHTML = "";
  for(const f of files){
    const li = document.createElement("li");
    try{
      const r = await fetch(f,{cache:"no-store"});
      if(!r.ok) throw new Error("No encontrado");
      li.textContent = "✅ " + f + " cargado correctamente";
      li.style.color = "green";
    }catch(e){
      li.textContent = "⚠️ " + f + " no accesible o faltante";
      li.style.color = "orange";
    }
    ul.appendChild(li);
  }
}

// === PRUEBA DE AUDIO ===
function testAudio(){
  const audio = document.getElementById("testAudio");
  const status = document.getElementById("audioStatus");
  audio.play().then(()=>{
    status.textContent = "✅ Audio reproducido correctamente";
    status.style.color = "green";
  }).catch(()=>{
    status.textContent = "⚠️ Error al reproducir (revisa permisos o ruta)";
    status.style.color = "orange";
  });
}

// === PRUEBA DE MAPA ===
function initMap(){
  const status = document.getElementById("mapStatus");
  const map = L.map('map').setView([39.47, -0.38], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);
  L.marker([39.47, -0.38]).addTo(map).bindPopup("Centro de Valencia");
  status.textContent = "✅ Mapa cargado correctamente";
  status.style.color = "green";
}

// === PRUEBA DE GPS ===
function testGPS(){
  const status = document.getElementById("gpsStatus");
  if("geolocation" in navigator){
    navigator.geolocation.getCurrentPosition(
      pos=>{
        const {latitude,longitude}=pos.coords;
        status.textContent=`✅ GPS activo (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
        status.style.color="green";
      },
      err=>{
        status.textContent="⚠️ No se pudo obtener ubicación ("+err.message+")";
        status.style.color="orange";
      }
    );
  }else{
    status.textContent="❌ Este navegador no soporta geolocalización";
    status.style.color="red";
  }
}
</script>
</body>
</html>
