<!DOCTYPE html>
<html lang="es">
<body>
  <!-- Botones principales -->
  <button id="hamburguesa" class="boton-flotante">â˜°</button>
  <button id="mas-opciones" class="boton-flotante">â‹®</button>
  <button id="btn-mapa" class="boton-flotante">ğŸŒ</button>

  <!-- Iconos hijos -->
  <button class="icono-flotante" id="icono-retos">ğŸ§©</button>
  <button class="icono-flotante" id="icono-gastronomia">ğŸ½ï¸</button>
  <button class="icono-flotante" id="icono-informacion">ğŸŒ</button>
  <button class="icono-flotante" id="icono-historia">ğŸ›ï¸</button>
  <button class="icono-flotante" id="icono-agradecimientos">ğŸ¤</button>
  <button class="icono-flotante" id="icono-seguridad">ğŸš¦</button>
  <button class="icono-flotante" id="icono-fuentes">ğŸ“š</button>
  <button class="icono-flotante" id="icono-punto">ğŸ“</button>
  <button class="icono-flotante" id="icono-ruta">ğŸ—ºï¸</button>
  <button class="icono-flotante" id="icono-brujula">ğŸ§­</button>

  <style>
    .boton-flotante, .icono-flotante {
      position: fixed;
      background: #007acc;
      color: white;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      user-select: none;
    }
    .icono-flotante {
      display: none;
      width: 44px;
      height: 44px;
      font-size: 1.5rem;
      z-index: 1002;
    }

    #hamburguesa { bottom: 12px; left: 12px; }
    #mas-opciones { bottom: 12px; right: 12px; }
    #btn-mapa { top: 12px; right: 12px; }
  </style>

  <script>
    const gruposIconos = {
      hamburguesa: ['icono-retos','icono-gastronomia','icono-informacion','icono-historia'],
      'mas-opciones': ['icono-agradecimientos','icono-seguridad','icono-fuentes'],
      'btn-mapa': ['icono-punto','icono-ruta','icono-brujula']
    };

    // Rango angular (grados) para repartir los iconos equidistantemente
    const rangosAngulos = {
      hamburguesa: [300, 360],    // desde 300Â° a 360Â° (arriba-derecha desde la esquina inferior izquierda)
      'mas-opciones': [180, 225], // desde 180Â° a 225Â° (izquierda-arriba desde la esquina inferior derecha)
      'btn-mapa': [90, 180]       // desde 90Â° a 180Â° (arriba-izquierda desde esquina superior derecha)
    };

    const enlacesIconos = {
      'icono-retos': 'retos_con_puzzles_Av1_es.html',
      'icono-gastronomia': 'Gastronomia.html',
      'icono-informacion': 'paginas_oficiales.html',
      'icono-historia': 'enlaces_valencia_historica.html',
      'icono-agradecimientos': 'Agradecimientos.html',
      'icono-seguridad': 'consejos_seguridad_vial.html',
      'icono-fuentes': null,
      'icono-punto': null,
      'icono-ruta': 'Av1_mapa_completo.html',
      'icono-brujula': 'mapas/Av1_mapa.jpg'
    };

    function ocultarTodos() {
      Object.values(gruposIconos).flat().forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
    }

    function mostrarIconos(idBoton, iconos, anguloInicio, anguloFin, margen = 5) {
      const b = document.getElementById(idBoton);
      const rect = b.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const totalIconos = iconos.length;
      const rangoAngulo = anguloFin - anguloInicio;

      // Ãngulos equidistantes
      const angulosActuales = [];
      for (let i = 0; i < totalIconos; i++) {
        if (totalIconos === 1) {
          angulosActuales.push((anguloInicio + anguloFin) / 2);
        } else {
          angulosActuales.push(anguloInicio + (rangoAngulo / (totalIconos - 1)) * i);
        }
      }

      // Calcular radio mÃ¡ximo posible para que ningÃºn icono salga del viewport con margen igual en todos lados
      let radioMax = Infinity;

      angulosActuales.forEach((angulo, i) => {
        const el = document.getElementById(iconos[i]);
        if (!el) return;

        const angRad = angulo * Math.PI / 180;
        const halfWidth = el.offsetWidth / 2;
        const halfHeight = el.offsetHeight / 2;

        // MÃ¡ximo radio horizontal
        let maxRadioX;
        if (Math.cos(angRad) > 0) {
          maxRadioX = (window.innerWidth - margen - halfWidth - cx) / Math.cos(angRad);
        } else if (Math.cos(angRad) < 0) {
          maxRadioX = (margen + halfWidth - cx) / Math.cos(angRad);
        } else {
          maxRadioX = Infinity;
        }

        // MÃ¡ximo radio vertical
        let maxRadioY;
        if (Math.sin(angRad) > 0) {
          maxRadioY = (window.innerHeight - margen - halfHeight - cy) / Math.sin(angRad);
        } else if (Math.sin(angRad) < 0) {
          maxRadioY = (margen + halfHeight - cy) / Math.sin(angRad);
        } else {
          maxRadioY = Infinity;
        }

        const maxRadioIcono = Math.min(maxRadioX, maxRadioY);
        if (maxRadioIcono < radioMax) {
          radioMax = maxRadioIcono;
        }
      });

      // Limitar radio mÃ¡ximo para que no quede muy lejos
      if (radioMax > 75) radioMax = 75;

      // Posicionar iconos
      angulosActuales.forEach((angulo, i) => {
        const el = document.getElementById(iconos[i]);
        if (!el) return;

        const angRad = angulo * Math.PI / 180;

        let x = cx + radioMax * Math.cos(angRad) - el.offsetWidth / 2;
        let y = cy + radioMax * Math.sin(angRad) - el.offsetHeight / 2;

        el.style.left = `${x}px`;
        el.style.top = `${y}px`;
        el.style.position = 'fixed';
        el.style.display = 'flex';
      });
    }

    function inicializarBotonesFlotantes() {
      Object.entries(gruposIconos).forEach(([botonId, iconoIds]) => {
        const boton = document.getElementById(botonId);
        if (!boton) return;

        boton.addEventListener('click', () => {
          const visible = iconoIds.some(id => document.getElementById(id)?.style.display === 'flex');
          ocultarTodos();
          if (!visible) mostrarIconos(botonId, iconoIds, rangosAngulos[botonId][0], rangosAngulos[botonId][1]);
        });
      });

      Object.entries(enlacesIconos).forEach(([iconoId, url]) => {
        const icono = document.getElementById(iconoId);
        if (!icono) return;

        icono.style.cursor = url ? 'pointer' : 'default';
        icono.addEventListener('click', () => {
          if (url) window.open(url, '_blank');
        });
      });
    }

    window.addEventListener('load', inicializarBotonesFlotantes);
  </script>
</body>
</html>
