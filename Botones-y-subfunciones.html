<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Iconos Radiales</title>
  <style>
    .boton-flotante, .icono-flotante {
      position: fixed;
      background: #007acc;
      color: white;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      user-select: none;
      transition: left 0.3s, top 0.3s, opacity 0.3s;
    }
    .icono-flotante {
      width: 44px;
      height: 44px;
      font-size: 1.5rem;
      z-index: 1002;
      display: none;
      opacity: 0;
      pointer-events: auto;
    }

    #hamburguesa { bottom: 12px; left: 12px; }
    #mas-opciones { bottom: 12px; right: 12px; }
    #btn-mapa { top: 12px; right: 12px; }
  </style>
</head>
<body>
  <!-- Botones principales -->
  <button id="hamburguesa" class="boton-flotante">☰</button>
  <button id="mas-opciones" class="boton-flotante">⋮</button>
  <button id="btn-mapa" class="boton-flotante">🌍</button>

  <!-- Iconos hijos -->
  <button class="icono-flotante" id="icono-retos">🧩</button>
  <button class="icono-flotante" id="icono-gastronomia">🍽️</button>
  <button class="icono-flotante" id="icono-informacion">🌐</button>
  <button class="icono-flotante" id="icono-historia">🏛️</button>
  <button class="icono-flotante" id="icono-agradecimientos">🤝</button>
  <button class="icono-flotante" id="icono-seguridad">🚦</button>
  <button class="icono-flotante" id="icono-fuentes">📚</button>
  <button class="icono-flotante" id="icono-punto">📍</button>
  <button class="icono-flotante" id="icono-ruta">🗺️</button>
  <button class="icono-flotante" id="icono-brujula">🧭</button>

  <script>
    const gruposIconos = {
      hamburguesa: ['icono-retos','icono-gastronomia','icono-informacion','icono-historia'],
      'mas-opciones': ['icono-agradecimientos','icono-seguridad','icono-fuentes'],
      'btn-mapa': ['icono-punto','icono-ruta','icono-brujula']
    };

    // Ángulo central y arco (en grados) para cada grupo, pensado como reloj (0° = 3h)
    const sectores = {
      hamburguesa: { centro: 45, arco: 90 },      // Entre 0h y 3h (45° es 1:30h)
      'mas-opciones': { centro: 315, arco: 90 },  // Entre 21h y 0h (315° es 10:30h)
      'btn-mapa': { centro: 225, arco: 90 }       // Entre 18h y 21h (225° es 7:30h)
    };

    let iconosVisibles = {};

    function ocultarTodos() {
      Object.values(gruposIconos).flat().forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.display = 'none';
          el.style.opacity = 0;
          iconosVisibles[id] = false;
        }
      });
    }

    function mostrarIconos(idBoton) {
      const iconos = gruposIconos[idBoton];
      if (!iconos) return;

      const b = document.getElementById(idBoton);
      const rect = b.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const sector = sectores[idBoton];
      const { centro, arco } = sector;
      const total = iconos.length;

      // Calcular ángulo de inicio para distribuir los iconos equidistantemente
      const anguloInicio = centro - arco / 2;

      // Máximo radio para que no se salgan de la pantalla (ajustando 60px padding)
      const padding = 60;
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const maxRadio = 150;

      // Vamos a reducir radio si algún icono queda fuera del viewport
      let radio = maxRadio;
      while (radio > 40) {
        let fuera = false;
        for (let i = 0; i < total; i++) {
          const angulo = total === 1 ? centro : anguloInicio + (arco / (total - 1)) * i;
          const rad = angulo * Math.PI / 180;
          const x = cx + radio * Math.cos(rad);
          const y = cy - radio * Math.sin(rad); // OJO, en pantalla y aumenta hacia abajo, por eso restamos
          if (x < padding || x > vw - padding || y < padding || y > vh - padding) {
            fuera = true;
            break;
          }
        }
        if (!fuera) break;
        radio -= 5;
      }

      // Posicionar los iconos
      for (let i = 0; i < total; i++) {
        const angulo = total === 1 ? centro : anguloInicio + (arco / (total - 1)) * i;
        const rad = angulo * Math.PI / 180;
        const x = cx + radio * Math.cos(rad);
        const y = cy - radio * Math.sin(rad);

        const el = document.getElementById(iconos[i]);
        if (el) {
          el.style.left = `${x - el.offsetWidth / 2}px`;
          el.style.top = `${y - el.offsetHeight / 2}px`;
          el.style.display = 'flex';
          el.style.opacity = 1;
          iconosVisibles[iconos[i]] = true;
        }
      }
    }

    function inicializarBotones() {
      Object.entries(gruposIconos).forEach(([botonId, iconoIds]) => {
        const boton = document.getElementById(botonId);
        if (!boton) return;

        boton.addEventListener('click', () => {
          const algunoVisible = iconoIds.some(id => iconosVisibles[id]);
          ocultarTodos();
          if (!algunoVisible) mostrarIconos(botonId);
        });
      });
    }

    function recalcularVisibles() {
      Object.entries(gruposIconos).forEach(([botonId, iconos]) => {
        const alguno = iconos.some(id => iconosVisibles[id]);
        if (alguno) mostrarIconos(botonId);
      });
    }

    window.addEventListener('load', inicializarBotones);
    window.addEventListener('resize', recalcularVisibles);
    window.addEventListener('orientationchange', () => setTimeout(recalcularVisibles, 200));
  </script>
</body>
</html>
