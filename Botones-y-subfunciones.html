<!DOCTYPE html>
<html lang="es">
<body>
  <!-- Botones principales flotantes -->
  <button id="hamburguesa" class="boton-flotante" style="pointer-events:auto;">‚ò∞</button>
  <button id="mas-opciones" class="boton-flotante" style="pointer-events:auto;">‚ãÆ</button>
  <button id="btn-mapa" class="boton-flotante" style="pointer-events:auto;">üåç</button>

  <!-- Iconos hijos flotantes (se muestran al pulsar un bot√≥n principal) -->
  <button class="icono-flotante" id="icono-retos" style="pointer-events:auto;">üß©</button>
  <button class="icono-flotante" id="icono-gastronomia" style="pointer-events:auto;">üçΩÔ∏è</button>
  <button class="icono-flotante" id="icono-informacion" style="pointer-events:auto;">üåê</button>
  <button class="icono-flotante" id="icono-historia" style="pointer-events:auto;">üèõÔ∏è</button>
  <button class="icono-flotante" id="icono-agradecimientos" style="pointer-events:auto;">ü§ù</button>
  <button class="icono-flotante" id="icono-seguridad" style="pointer-events:auto;">üö¶</button>
  <button class="icono-flotante" id="icono-fuentes" style="pointer-events:auto;">üìö</button>
  <button class="icono-flotante" id="icono-punto" style="pointer-events:auto;">üìç</button>
  <button class="icono-flotante" id="icono-ruta" style="pointer-events:auto;">üó∫Ô∏è</button>
  <button class="icono-flotante" id="icono-brujula" style="pointer-events:auto;">üß≠</button>

  <style>
    /* Estilos generales para botones principales e iconos hijos */
    .boton-flotante, .icono-flotante {
      position: fixed;
      background: #007acc;
      color: white;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      user-select: none;
      z-index: 3300 !important;
      pointer-events: auto;
    }
    /* Iconos hijos: ocultos por defecto solo con opacity y visibility */
    .icono-flotante {
      width: 44px;
      height: 44px;
      font-size: 1.5rem;
      z-index: 3300 !important;
      transition: opacity 0.3s ease;
      pointer-events: auto;
      display: none;         /* Ocultos por defecto */
      opacity: 0;
      visibility: hidden;
    }
    /* Posici√≥n de los botones principales */
    #hamburguesa { bottom: 75px; left: 12px; }
    #mas-opciones { bottom: 75px; right: 12px; }
    #btn-mapa { top: 12px; right: 12px; }
  </style>

  <script>
    // --- Configuraci√≥n de los grupos de iconos hijos por cada bot√≥n principal ---
    const gruposIconos = {
      hamburguesa: ['icono-retos','icono-gastronomia','icono-informacion','icono-historia'],
      'mas-opciones': ['icono-agradecimientos','icono-seguridad','icono-fuentes'],
      'btn-mapa': ['icono-punto','icono-ruta','icono-brujula']
    };

    // --- √Ångulos y radios para la disposici√≥n de los iconos hijos alrededor del bot√≥n principal ---
    const sectores = {
      hamburguesa: { centro: 45, arco: 90 },
      'mas-opciones': { centro: 135, arco: 90 },
      'btn-mapa': { centro: 225, arco: 90 }
    };
    const radios = {
      hamburguesa: 85,
      'mas-opciones': 70,
      'btn-mapa': 70
    };

    // --- Enlaces asociados a cada icono hijo (null si no hay enlace) ---
    const enlacesIconos = {
      'icono-retos': 'retos_con_puzzles_Av1_es.html',
      'icono-gastronomia': 'Gastronomia.html',
      'icono-informacion': 'paginas_oficiales.html',
      'icono-historia': 'enlaces_valencia_historica.html',
      'icono-agradecimientos': 'Agradecimientos.html',
      'icono-seguridad': 'consejos_seguridad_vial.html',
      'icono-fuentes': null,
      'icono-punto': null,
      'icono-ruta': 'Av1_mapa_completo.html',
      'icono-brujula': 'mapas/Av1_mapa.jpg'
    };

    // --- Variables de control de estado ---
    let iconosVisibles = {};
    let ultimoBoton = null;

    // --- Oculta todos los iconos hijos ---
    function ocultarTodos() {
      Object.values(gruposIconos).flat().forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.display = 'none';
          el.style.visibility = 'hidden';
          el.style.opacity = 0;
          iconosVisibles[id] = false;
        }
      });
      localStorage.removeItem('ultimoBoton');
    }

    // --- Muestra los iconos hijos del bot√≥n principal pulsado ---
    function mostrarIconos(idBoton) {
      const iconos = gruposIconos[idBoton];
      if (!iconos) return;

      // Calcula la posici√≥n central del bot√≥n principal
      const b = document.getElementById(idBoton);
      const rect = b.getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      // Calcula la disposici√≥n circular de los iconos hijos
      const { centro, arco } = sectores[idBoton];
      const total = iconos.length;
      const inicio = centro - arco / 2;
      const radio = radios[idBoton] || 100;

      for (let i = 0; i < total; i++) {
        const angulo = total === 1 ? centro : inicio + (arco / (total - 1)) * i;
        const rad = angulo * Math.PI / 180;
        const x = cx + radio * Math.cos(rad);
        const y = cy - radio * Math.sin(rad);

        const el = document.getElementById(iconos[i]);
        if (el) {
          el.style.display = 'flex';
          el.style.visibility = 'visible';
          el.style.opacity = 1;
          el.style.left = `${x - el.offsetWidth / 2}px`;
          el.style.top = `${y - el.offsetHeight / 2}px`;
          el.style.position = 'fixed';
          el.style.zIndex = 3300;
          iconosVisibles[iconos[i]] = true;
        }
      }
      ultimoBoton = idBoton;
      localStorage.setItem('ultimoBoton', idBoton);
    }

    // --- Pausa el audio del iframe hijo al pulsar un bot√≥n ---
    function pausarAudioHijo() {
      window.parent.postMessage({ type: 'pauseAudioFromBoton' }, '*');
    }

    // --- Inicializa los eventos de los botones principales e iconos hijos ---
    function inicializarBotonesFlotantes() {
      // Eventos para los botones principales
      Object.entries(gruposIconos).forEach(([botonId, iconoIds]) => {
        const boton = document.getElementById(botonId);
        if (!boton) return;
        boton.addEventListener('click', () => {
          pausarAudioHijo();
          const algunoVisible = iconoIds.some(id => iconosVisibles[id]);
          ocultarTodos();
          if (!algunoVisible) {
            mostrarIconos(botonId);
          } else {
            ultimoBoton = null;
            localStorage.removeItem('ultimoBoton');
          }
        });
      });

      // Eventos para los iconos hijos (abrir enlaces o pausar audio)
      Object.entries(enlacesIconos).forEach(([id, url]) => {
        const el = document.getElementById(id);
        if (el && url) {
          el.addEventListener('click', () => {
            pausarAudioHijo();
            window.open(url, '_blank');
          });
        } else if (el) {
          el.addEventListener('click', pausarAudioHijo);
        }
      });

      // Si hay un bot√≥n guardado en localStorage, muestra sus iconos al cargar
      setTimeout(() => {
        const guardado = localStorage.getItem('ultimoBoton');
        if (guardado && gruposIconos[guardado]) {
          mostrarIconos(guardado);
        }
      }, 100);

      // Recoloca los iconos al cambiar el tama√±o de la ventana o la orientaci√≥n
      window.addEventListener('resize', () => {
        if (ultimoBoton) mostrarIconos(ultimoBoton);
      });
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          if (ultimoBoton) mostrarIconos(ultimoBoton);
        }, 200);
      });

      // Permite ocultar todos los iconos desde mensajes externos
      window.addEventListener('message', (event) => {
        if (event.data && event.data.type === 'ocultarTodos') {
          ocultarTodos();
        }
      });
    }

    // --- Inicializa los botones flotantes al cargar el documento ---
    if (typeof inicializarBotonesFlotantes === 'function') {
      inicializarBotonesFlotantes();
    } else {
      window.addEventListener('DOMContentLoaded', inicializarBotonesFlotantes);
    }
  </script>
</body>
</html>
