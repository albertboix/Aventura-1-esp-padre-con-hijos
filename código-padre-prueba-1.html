<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Padre Mejorada</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #mapa {
      height: 100vh;
      width: 100vw;
    }

    /* Botones flotantes grandes */
    .boton-flotante-grande, .boton-flotante {
      position: fixed;
      background: #007acc;
      color: white;
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 2.4rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      user-select: none;
      z-index: 12000;
    }

    #hamburguesa {
      bottom: 15px;
      left: 15px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 2.4rem;
    }

    #mas-opciones {
      bottom: 15px;
      right: 15px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 2.4rem;
    }

    #btn-mapa {
      top: 15px;
      right: 15px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 2.4rem;
    }

    #gps-prueba {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 13000;
      width: 130px;
      height: 40px;
      font-size: 1rem;
      border-radius: 6px;
      text-align: center;
      background: red;
      cursor: pointer;
      user-select: none;
    }

    .panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      color: black;
      z-index: 13000;
      display: none;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
    }

    .panel.titulo-pesta√±as {
      width: 75vw;
      max-width: 400px;
      height: auto;
      max-height: 80vh;
      top: 10vh;
      left: calc(50% - 37.5vw);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      background: white;
    }

    .pesta√±a-opcion {
      background: #f0f0f0;
      border-radius: 8px;
      padding: 15px 20px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      user-select: none;
      transition: background-color 0.3s ease;
    }

    .pesta√±a-opcion:hover {
      background: #d0eaff;
    }

    /* Panel pantalla completa contenido */
    #contenido-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 14000;
      display: none;
      flex-direction: column;
    }

    #contenido-fullscreen iframe {
      flex-grow: 1;
      border: none;
      width: 100%;
      height: 100%;
    }

    /* Bot√≥n cerrar contenido fullscreen */
    #btn-cerrar-contenido {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #005f99; /* azul fondo */
      color: orange; /* texto naranja */
      border: none;
      border-radius: 6px;
      padding: 10px 14px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      z-index: 15000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: background-color 0.3s ease;
    }
    #btn-cerrar-contenido:hover {
      background: #004a7c;
    }
  </style>
</head>
<body>
  <div id="mapa"></div>
  <iframe id="hijo" src="Av1-coordenadas.html" style="width:0; height:0; border:none; position:absolute; z-index:-1;"></iframe>

  <button id="hamburguesa" class="boton-flotante">‚ò∞</button>
  <button id="mas-opciones" class="boton-flotante">‚ãÆ</button>
  <button id="btn-mapa" class="boton-flotante">üåç</button>
  <button id="gps-prueba">GPS Prueba Casa</button>

  <!-- Panel t√≠tulos hamburguesa -->
  <div id="panel-hamburguesa" class="panel titulo-pesta√±as">
    <div class="pesta√±a-opcion" data-url="retos_con_puzzles_Av1_es.html">1 Retos y Puzzles</div>
    <div class="pesta√±a-opcion" data-url="Gastronomia.html">2 Gastronom√≠a</div>
    <div class="pesta√±a-opcion" data-url="paginas_oficiales.html">3 P√°ginas Oficiales</div>
    <div class="pesta√±a-opcion" data-url="enlaces_valencia_historica.html">4 Val√®ncia Hist√≥rica</div>
  </div>

  <!-- Panel t√≠tulos tres puntos -->
  <div id="panel-trespuntos" class="panel titulo-pesta√±as">
    <div class="pesta√±a-opcion" data-url="Agradecimientos.html">1 Agradecimientos</div>
    <div class="pesta√±a-opcion" data-url="consejos_seguridad_vial.html">2 Consejos y Seguridad</div>
    <div class="pesta√±a-opcion">3 Fuentes (en desarrollo)</div>
  </div>

  <!-- Panel t√≠tulos bot√≥n mapa -->
  <div id="panel-mapa" class="panel titulo-pesta√±as">
    <div class="pesta√±a-opcion" data-mensaje="{ tipo: 'mostrar_siguiente' }">üìç Siguiente Punto</div>
    <div class="pesta√±a-opcion" data-mensaje="{ tipo: 'mostrar_ruta' }">üó∫Ô∏è Ruta Completa</div>
    <div class="pesta√±a-opcion" id="abrir-brujula">üß≠ Br√∫jula</div>
  </div>

  <!-- Contenido pantalla completa con iframe -->
  <div id="contenido-fullscreen">
    <button id="btn-cerrar-contenido">X</button>
    <iframe src="" id="iframe-contenido"></iframe>
  </div>

  <div id="imagen-full">
    <button class="cerrar-panel" onclick="cerrarPanel()">X</button>
    <img src="mapas/Av1_mapa.jpg" alt="Mapa completo" />
  </div>

  <div id="terminos">
    <iframe src="terminos_y_condiciones.html" title="T√©rminos y condiciones"></iframe>
    <button id="aceptar-terminos">Aceptar</button>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Inicializar mapa Leaflet
    const mapa = L.map('mapa').setView([39.4699, -0.3763], 14); // Valencia

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(mapa);

    // Control GPS activado/desactivado
    let gpsActivo = false;
    const btnGps = document.getElementById('gps-prueba');
    btnGps.addEventListener('click', () => {
      gpsActivo = !gpsActivo;
      btnGps.style.background = gpsActivo ? 'green' : 'red';
      btnGps.textContent = gpsActivo ? 'Modo casa OFF' : 'Modo casa ON';
      document.getElementById('hijo').contentWindow.postMessage({ tipo: 'gps_modo', activo: gpsActivo }, '*');
    });

    // Variables panel y contenido
    const panelHamburguesa = document.getElementById('panel-hamburguesa');
    const panelTresPuntos = document.getElementById('panel-trespuntos');
    const panelMapa = document.getElementById('panel-mapa');
    const contenidoFull = document.getElementById('contenido-fullscreen');
    const iframeContenido = document.getElementById('iframe-contenido');
    const btnCerrarContenido = document.getElementById('btn-cerrar-contenido');

    // Funci√≥n cerrar todos paneles y contenido
    function cerrarPaneles() {
      panelHamburguesa.style.display = 'none';
      panelTresPuntos.style.display = 'none';
      panelMapa.style.display = 'none';
      contenidoFull.style.display = 'none';
      iframeContenido.src = '';
    }

    // Toggle panel hamburguesa
    document.getElementById('hamburguesa').addEventListener('click', () => {
      if (panelHamburguesa.style.display === 'flex') {
        cerrarPaneles();
      } else {
        cerrarPaneles();
        panelHamburguesa.style.display = 'flex';
      }
    });

    // Toggle panel tres puntos
    document.getElementById('mas-opciones').addEventListener('click', () => {
      if (panelTresPuntos.style.display === 'flex') {
        cerrarPaneles();
      } else {
        cerrarPaneles();
        panelTresPuntos.style.display = 'flex';
      }
    });

    // Toggle panel mapa
    document.getElementById('btn-mapa').addEventListener('click', () => {
      if (panelMapa.style.display === 'flex') {
        cerrarPaneles();
      } else {
        cerrarPaneles();
        panelMapa.style.display = 'flex';
      }
    });

    // Abrir contenido fullscreen desde pesta√±as hamburguesa y tres puntos
    function abrirContenido(url) {
      cerrarPaneles();
      iframeContenido.src = url;
      contenidoFull.style.display = 'flex';
    }

    // Manejo clicks pesta√±as hamburguesa
    panelHamburguesa.querySelectorAll('.pesta√±a-opcion').forEach(div => {
      div.addEventListener('click', () => {
        const url = div.dataset.url;
        if (url) abrirContenido(url);
      });
    });

    // Manejo clicks pesta√±as tres puntos
    panelTresPuntos.querySelectorAll('.pesta√±a-opcion').forEach(div => {
      div.addEventListener('click', () => {
        const url = div.dataset.url;
        if (url) abrirContenido(url);
      });
    });

    // Manejo clicks pesta√±as mapa (env√≠o mensajes o acciones)
    panelMapa.querySelectorAll('.pesta√±a-opcion').forEach(div => {
      div.addEventListener('click', () => {
        if (div.id === 'abrir-brujula') {
          // Aqu√≠ podr√≠as abrir la br√∫jula si est√° implementada
          alert('Br√∫jula no implementada a√∫n');
        } else {
          // Para los otros que usan data-mensaje, mandar mensaje al iframe hijo
          const mensaje = div.dataset.mensaje;
          if (mensaje) {
            try {
              const objMensaje = JSON.parse(mensaje.replace(/'/g,'"'));
              document.getElementById('hijo').contentWindow.postMessage(objMensaje, '*');
            } catch(e) {
              console.error('Error parseando mensaje:', e);
            }
          }
        }
        cerrarPaneles();
      });
    });

    // Cerrar contenido fullscreen
    btnCerrarContenido.addEventListener('click', () => {
      contenidoFull.style.display = 'none';
      iframeContenido.src = '';
      // Al cerrar, mostrar la √∫ltima pesta√±a abierta o ninguna
      // Aqu√≠ simplemente no mostramos paneles para evitar confusi√≥n
    });
  </script>
</body>
</html>
