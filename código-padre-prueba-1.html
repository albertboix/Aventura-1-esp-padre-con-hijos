<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>App Aventura - Padre</title>
  <style>
    body.no-interactivo *:not(#modal-terminos):not(#modal-terminos *) {
      pointer-events: none;
      user-select: none;
    }

    .boton-flotante {
      position: fixed;
      z-index: 1000;
      background: #007BFF;
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
    }

    #btn-hamburguesa {
      bottom: 20px;
      left: 20px;
    }

    #btn-tres-puntos {
      bottom: 20px;
      right: 20px;
    }

    #btn-mapa {
      top: 20px;
      right: 20px;
    }

    .submenu {
      position: fixed;
      background: white;
      border: 1px solid #ccc;
      z-index: 999;
      display: none;
      flex-direction: column;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .submenu button {
      padding: 10px;
      border: none;
      background: #fff;
      cursor: pointer;
      text-align: left;
    }

    #pantalla-completa {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      display: none;
      z-index: 1100;
    }

    #pantalla-completa iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    #modal-terminos {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      z-index: 1200;
      display: flex;
      flex-direction: column;
    }

    #contenido-terminos {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #contenido-terminos iframe {
      flex: 1;
      width: 100%;
      border: none;
    }

    #btn-aceptar-terminos {
      padding: 20px;
      font-size: 20px;
      width: 100%;
      background: #004080;
      color: white;
      border: none;
    }

    #simular-gps {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 2000;
      background: red;
      color: white;
      padding: 10px;
      display: none;
    }
  </style>
</head>
<body class="no-interactivo">

<div id="mapa-contenedor"></div>
<div id="btn-hamburguesa" class="boton-flotante" title="Men√∫">&#9776;</div>
<div id="btn-tres-puntos" class="boton-flotante" title="Opciones">&#8942;</div>
<div id="btn-mapa" class="boton-flotante" title="Mapa">&#128506;</div>

<div id="submenu-hamburguesa" class="submenu">
  <button data-url="retos_con_puzzles_Av1_es.html">Retos y Puzzles</button>
  <button data-url="Gastronomia.html">Gastronom√≠a</button>
  <button data-url="paginas_oficiales.html">P√°ginas Oficiales</button>
  <button data-url="enlaces_valencia_historica.html">Val√®ncia Hist√≥rica</button>
</div>

<div id="submenu-tres-puntos" class="submenu">
  <button data-url="Agradecimientos.html">Agradecimientos</button>
  <button data-url="consejos_seguridad_vial.html">Consejos Seguridad Vial</button>
  <button data-url="fuentes_informacion.html">Fuentes (En desarrollo)</button>
</div>

<div id="submenu-mapa" class="submenu">
  <button data-url="Av1-coordenadas.html">üìç Coordenadas</button>
  <button data-url="mapa-aventura.html">üó∫Ô∏è Ruta Completa</button>
  <button data-url="mapas/Av1_mapa.jpg">üß≠ Mapa Tradicional</button>
</div>

<div id="pantalla-completa">
  <iframe id="iframe-contenido" src="" allow="geolocation; autoplay" allowfullscreen></iframe>
</div>

<div id="modal-terminos">
  <div id="contenido-terminos">
    <iframe src="terminos_y_condiciones.html"></iframe>
    <button id="btn-aceptar-terminos">Aceptar t√©rminos y condiciones</button>
  </div>
</div>

<button id="simular-gps">Simular GPS</button>

<script>
  let gpsActivo = false;
  let audioActivo = false;
  let permisosAceptados = false;
  const modoSimulacion = true;

  const body = document.body;
  const modalTerminos = document.getElementById('modal-terminos');
  const btnAceptarTerminos = document.getElementById('btn-aceptar-terminos');
  const pantallaCompleta = document.getElementById('pantalla-completa');
  const iframeContenido = document.getElementById('iframe-contenido');

  const submenuHamburguesa = document.getElementById('submenu-hamburguesa');
  const submenuTresPuntos = document.getElementById('submenu-tres-puntos');
  const submenuMapa = document.getElementById('submenu-mapa');

  function pedirPermisoGPS() {
    return new Promise((resolve, reject) => {
      if (modoSimulacion) {
        resolve({ latitude: 39.4702, longitude: -0.3768 });
        return;
      }
      if (!navigator.geolocation) {
        alert('Geolocalizaci√≥n no disponible');
        reject();
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => resolve(pos.coords),
        err => {
          alert('Permiso GPS denegado o error obteniendo ubicaci√≥n.');
          reject();
        }
      );
    });
  }

  function pedirPermisoAudio() {
    return new Promise((resolve, reject) => {
      try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.resume().then(() => resolve(true)).catch(() => reject());
      } catch (e) {
        reject();
      }
    });
  }

  btnAceptarTerminos.addEventListener('click', async () => {
    try {
      await pedirPermisoGPS();
      gpsActivo = true;
      await pedirPermisoAudio();
      audioActivo = true;
      permisosAceptados = true;
      modalTerminos.style.display = 'none';
      body.classList.remove('no-interactivo');
    } catch {
      alert('Debes aceptar los permisos para continuar.');
    }
  });

  document.getElementById('simular-gps').addEventListener('click', () => {
    permisosAceptados = true;
    modalTerminos.style.display = 'none';
    body.classList.remove('no-interactivo');
    alert("Modo simulaci√≥n activado: est√°s en Plaza del Ayuntamiento");
  });

  function ocultarSubmenus() {
    submenuHamburguesa.style.display = 'none';
    submenuTresPuntos.style.display = 'none';
    submenuMapa.style.display = 'none';
  }

  document.getElementById('btn-hamburguesa').onclick = () => {
    if (!permisosAceptados) return alert('Debes aceptar t√©rminos y permisos.');
    ocultarSubmenus();
    submenuHamburguesa.style.display = 'flex';
  };
  document.getElementById('btn-tres-puntos').onclick = () => {
    if (!permisosAceptados) return alert('Debes aceptar t√©rminos y permisos.');
    ocultarSubmenus();
    submenuTresPuntos.style.display = 'flex';
  };
  document.getElementById('btn-mapa').onclick = () => {
    if (!permisosAceptados) return alert('Debes aceptar t√©rminos y permisos.');
    ocultarSubmenus();
    submenuMapa.style.display = 'flex';
  };

  document.querySelectorAll('.submenu button').forEach(btn => {
    btn.onclick = () => {
      if (!permisosAceptados) return alert('Debes aceptar t√©rminos y permisos.');
      pantallaCompleta.style.display = 'flex';
      iframeContenido.src = btn.dataset.url;
    }
  });

  window.addEventListener('click', e => {
    if (!e.target.closest('.boton-flotante') && !e.target.closest('.submenu')) ocultarSubmenus();
  });
</script>
</body>
</html>
