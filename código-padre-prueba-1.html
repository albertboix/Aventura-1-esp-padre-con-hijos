<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aventura Valencia 1</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }

    #map {
      height: 100%;
      width: 100%;
      z-index: 1;
    }

    .boton-flotante {
      position: fixed;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px;
      z-index: 1000;
      cursor: pointer;
    }

    .hamburguesa {
      bottom: 10px;
      left: 10px;
    }

    .tres-puntos {
      bottom: 10px;
      right: 10px;
    }

    .boton-tierra {
      top: 10px;
      right: 10px;
    }

    .boton-gps {
      top: 10px;
      left: 10px;
      padding: 10px 15px;
      background-color: red;
    }

    .menu-desplegable, .menu-tierra {
      position: fixed;
      background: white;
      color: black;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 2000;
      display: none;
      flex-direction: column;
      padding: 20px;
    }

    .menu-desplegable a, .menu-tierra button {
      margin: 10px 0;
      font-size: 20px;
    }

    .cerrar-menu {
      position: absolute;
      top: 10px;
      right: 10px;
      background: deepskyblue;
      color: orange;
      border: none;
      font-size: 24px;
      padding: 5px 10px;
      cursor: pointer;
    }

    #iframe-hijo {
      display: none;
      width: 100%;
      height: 100%;
      border: none;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1500;
    }

    #cerrar-iframe {
      display: none;
      position: fixed;
      top: 10px;
      right: 10px;
      background: deepskyblue;
      color: orange;
      z-index: 1600;
      padding: 10px;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    #modal-condiciones {
      position: fixed;
      z-index: 3000;
      background: white;
      color: black;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #modal-condiciones iframe {
      flex: 1;
      border: none;
    }

    #modal-condiciones button {
      padding: 20px;
      background: deepskyblue;
      color: white;
      font-size: 20px;
      border: none;
      cursor: pointer;
    }

    #mapa-img {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 2500;
    }

  </style>
</head>
<body>

  <div id="map"></div>

  <button class="boton-flotante hamburguesa" onclick="mostrarMenu('hamburguesa')">‚ò∞</button>
  <button class="boton-flotante tres-puntos" onclick="mostrarMenu('tresPuntos')">‚ãÆ</button>
  <button class="boton-flotante boton-tierra" onclick="mostrarMenuTierra()">üåç</button>
  <button id="gpsCasa" class="boton-flotante boton-gps" onclick="toggleGps()">GPS Prueba Casa</button>

  <div id="menu-hamburguesa" class="menu-desplegable">
    <button class="cerrar-menu" onclick="cerrarMenus()">X</button>
    <a href="retos_con_puzzles_Av1_es.html">Retos y Puzzles</a>
    <a href="Gastronomia.html">Gastronom√≠a</a>
    <a href="paginas_oficiales.html">P√°ginas Oficiales</a>
    <a href="enlaces_valencia_historica.html">Val√®ncia Hist√≥rica</a>
  </div>

  <div id="menu-tresPuntos" class="menu-desplegable">
    <button class="cerrar-menu" onclick="cerrarMenus()">X</button>
    <a href="Agradecimientos.html">Agradecimientos</a>
    <a href="consejos_seguridad_vial.html">Consejos y Seguridad</a>
    <p>Fuentes: <strong>En desarrollo</strong></p>
  </div>

  <div id="menu-tierra" class="menu-tierra">
    <button class="cerrar-menu" onclick="cerrarMenus()">X</button>
    <button onclick="siguientePunto()">üìç Ir al siguiente punto</button>
    <button onclick="mostrarTodasParadas()">üó∫ Ver todas las paradas</button>
    <button onclick="mostrarImagen()">üß≠ Ver mapa imagen</button>
  </div>

  <iframe id="iframe-hijo" src="Av1-coordenadas.html"></iframe>
  <button id="cerrar-iframe" onclick="cerrarIframe()">X</button>

  <img id="mapa-img" src="mapas/Av1_mapa.jpg" />

  <div id="modal-condiciones">
    <iframe src="terminos_y_condiciones.html"></iframe>
    <button onclick="document.getElementById('modal-condiciones').style.display='none'">Aceptar</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([39.4699, -0.3763], 14); // Val√®ncia
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let gpsActivo = false;
    function toggleGps() {
      gpsActivo = !gpsActivo;
      const boton = document.getElementById('gpsCasa');
      boton.style.backgroundColor = gpsActivo ? 'green' : 'red';
    }

    function mostrarMenu(id) {
      cerrarMenus();
      document.getElementById(`menu-${id}`).style.display = 'flex';
    }

    function mostrarMenuTierra() {
      cerrarMenus();
      document.getElementById('menu-tierra').style.display = 'flex';
    }

    function cerrarMenus() {
      ['menu-hamburguesa', 'menu-tresPuntos', 'menu-tierra'].forEach(id => {
        document.getElementById(id).style.display = 'none';
      });
    }

    function siguientePunto() {
      const iframe = document.getElementById('iframe-hijo');
      iframe.contentWindow.postMessage({ tipo: 'mostrar_siguiente_punto' }, '*');
      cerrarMenus();
    }

    function mostrarTodasParadas() {
      const iframe = document.getElementById('iframe-hijo');
      iframe.style.display = 'block';
      document.getElementById('cerrar-iframe').style.display = 'block';
      iframe.contentWindow.postMessage({ tipo: 'mostrar_todas_paradas' }, '*');
      cerrarMenus();
    }

    function mostrarImagen() {
      document.getElementById('mapa-img').style.display = 'block';
      screen.orientation.lock?.('portrait').catch(() => {});
      cerrarMenus();
    }

    function cerrarIframe() {
      document.getElementById('iframe-hijo').style.display = 'none';
      document.getElementById('cerrar-iframe').style.display = 'none';
    }

    window.addEventListener('message', (event) => {
      if (event.data.tipo === 'parada_detectada') {
        console.log('Parada detectada:', event.data.id);
        // activarBotonPlay(event.data.id); // define si es necesario
      }
      if (event.data.tipo === 'paradas') {
        console.log('Recibidas paradas:', event.data.paradas);
      }
    });
  </script>
</body>
</html>
