<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>App Padre Completo</title>
<style>
  body {
    margin:0; font-family: Arial, sans-serif;
    background:#f0f0f0;
  }
  /* Botones flotantes */
  .btnFlotante {
    position: fixed;
    width: 60px; height: 60px;
    border-radius: 30px;
    background: #003366; /* azul marino */
    color: white;
    font-size: 28px;
    line-height: 60px;
    text-align: center;
    cursor: pointer;
    z-index: 9999;
    user-select: none;
  }
  #btnMapaTradicional {
    top: 10px;
    right: 10px;
  }
  #btnHamburguesa {
    bottom: 80px;
    right: 10px;
  }
  #btnCoordenadas {
    bottom: 150px;
    right: 10px;
  }
  #btnRutaCompleta {
    bottom: 220px;
    right: 10px;
  }
  /* Submen√∫s */
  .submenu {
    display: none;
    position: fixed;
    right: 80px;
    background: #004080;
    border-radius: 8px;
    padding: 10px;
    color: white;
    max-width: 270px;
    max-height: 300px;
    overflow-y: auto;
    font-size: 14px;
    z-index: 9998;
  }
  /* Cierre modal */
  .modalCerrar {
    position: absolute;
    top: 10px; right: 10px;
    background: #003366;
    border-radius: 4px;
    color: orange;
    font-weight: bold;
    font-size: 24px;
    width: 32px;
    height: 32px;
    line-height: 32px;
    text-align: center;
    cursor: pointer;
    z-index: 10001;
    user-select: none;
  }
  /* Modal mapa tradicional */
  #modalMapaTradicional {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    justify-content: center;
    align-items: center;
  }
  #modalMapaTradicional img {
    max-width: 95vw;
    max-height: 95vh;
    object-fit: contain;
    touch-action: pinch-zoom;
  }
</style>
</head>
<body>

<!-- Botones flotantes -->
<div id="btnMapaTradicional" class="btnFlotante" title="Mapa Tradicional">üó∫Ô∏è</div>
<div id="btnHamburguesa" class="btnFlotante" title="Men√∫">‚ò∞</div>
<div id="btnCoordenadas" class="btnFlotante" title="Coordenadas">üìç</div>
<div id="btnRutaCompleta" class="btnFlotante" title="Ruta Completa">üõ§Ô∏è</div>

<!-- Submen√∫s -->
<div id="submenuHamburguesa" class="submenu">
  <div><button id="toggleAudioBtn">‚ñ∂Ô∏è Reproducir Audio</button></div>
  <div><button id="openPuzzleBtn">üß© Abrir Puzzle</button></div>
  <div><button id="toggleGPSBtn">üì° GPS On/Off</button></div>
</div>

<div id="submenuCoordenadas" class="submenu">
  <p>Coordenadas actuales y detalles.</p>
</div>

<div id="submenuRutaCompleta" class="submenu">
  <p>Visualizaci√≥n de toda la ruta con paradas:</p>
  <ul id="listaParadas" style="padding-left:1em; max-height: 250px; overflow-y:auto; font-size: 13px;"></ul>
</div>

<!-- Modal Mapa Tradicional -->
<div id="modalMapaTradicional" role="dialog" aria-modal="true" aria-label="Mapa Tradicional">
  <div class="modalCerrar" id="cerrarModalMapaTradicional" title="Cerrar">√ó</div>
  <img src="mapas/Av1_mapa.jpg" alt="Mapa Tradicional" />
</div>

<!-- Iframe -->
<iframe id="iframeHijo" src="Av1-coordenadas.html" style="width:100%; height:80vh; border:none;"></iframe>

<script>
  // Datos paradas con coordenadas, audio y puzzle (modifica rutas audio/puzzle seg√∫n tu estructura)
  const paradas = [
    {id:'00', nombre:'Torres de Serranos (start) Plaza de los Fueros', coords:[39.47876, -0.37626], audio:'audio/00.mp3', puzzle:'puzzles/00.html'},
    {id:'01', nombre:'Puente de Serranos ‚Äì Plaza de la crida', coords:[39.47959, -0.37583], audio:'audio/01.mp3', puzzle:'puzzles/01.html'},
    {id:'02', nombre:'Cortes Valencianas (Palacio de los Borgia)', coords:[39.47785, -0.37485], audio:'audio/02.mp3', puzzle:'puzzles/02.html'},
    {id:'03', nombre:'Plaza de la Virgen', coords:[39.47656, -0.37529], audio:'audio/03.mp3', puzzle:'puzzles/03.html'},
    {id:'04', nombre:'Plaza de la Almo√≠na', coords:[39.47609, -0.37449], audio:'audio/04.mp3', puzzle:'puzzles/04.html'},
    {id:'05', nombre:'Catedral de Val√®ncia', coords:[39.47594, -0.37474], audio:'audio/05.mp3', puzzle:'puzzles/05.html'},
    {id:'06', nombre:'Plaza decimo Juno Bruto (Museo Arqueol√≥gico de la Almo√≠na)', coords:[39.4762, -0.37412], audio:'audio/06.mp3', puzzle:'puzzles/06.html'},
    {id:'07', nombre:'Bas√≠lica de Val√®ncia', coords:[39.47611, -0.37478], audio:'audio/07.mp3', puzzle:'puzzles/07.html'},
    {id:'08', nombre:'Palacio Arzobispal', coords:[39.4755, -0.37436], audio:'audio/08.mp3', puzzle:'puzzles/08.html'},
    {id:'09', nombre:'Plaza del Ayuntamiento', coords:[39.47056, -0.37677], audio:'audio/09.mp3', puzzle:'puzzles/09.html'},
    {id:'10', nombre:'Edificio del Ayuntamiento de Val√®ncia', coords:[39.46971, -0.37693], audio:'audio/10.mp3', puzzle:'puzzles/10.html'},
    {id:'11', nombre:'Estaci√≥n de Ferrocarril (Estaci√≥n del Norte)', coords:[39.46722, -0.37702], audio:'audio/11.mp3', puzzle:'puzzles/11.html'},
    {id:'12', nombre:'Plaza de Toros de Val√®ncia', coords:[39.46709, -0.37595], audio:'audio/12.mp3', puzzle:'puzzles/12.html'},
    {id:'13', nombre:'Casa estilo √Årabe', coords:[39.46753, -0.37511], audio:'audio/13.mp3', puzzle:'puzzles/13.html'},
    {id:'14', nombre:'Palacio de Comunicaciones (Correos)', coords:[39.46942, -0.37559], audio:'audio/14.mp3', puzzle:'puzzles/14.html'},
    {id:'15', nombre:'Antigua sede del Banco de Val√®ncia', coords:[39.47061, -0.37408], audio:'audio/15.mp3', puzzle:'puzzles/15.html'},
    {id:'16', nombre:'Palacio del Marqu√©s de Dos Aguas (Museo Nacional de Cr√°mica)', coords:[39.47276, -0.37467], audio:'audio/16.mp3', puzzle:'puzzles/16.html'},
    {id:'17', nombre:'Mercado Central', coords:[39.47377, -0.37832], audio:'audio/17.mp3', puzzle:'puzzles/17.html'},
    {id:'18', nombre:'San Juan del Mercado (Iglesia de los Santos Juanes)', coords:[39.47425, -0.37895], audio:'audio/18.mp3', puzzle:'puzzles/18.html'},
    {id:'19', nombre:'Lonja de Val√®ncia (Mercado de la Seda)', coords:[39.47426, -0.37862], audio:'audio/19.mp3', puzzle:'puzzles/19.html'},
    {id:'20', nombre:'Plaza del Doctor Collado', coords:[39.47444, -0.3779], audio:'audio/20.mp3', puzzle:'puzzles/20.html'},
    {id:'21', nombre:'Plaza del Negrito (Fuente del Negrito)', coords:[39.47611, -0.37741], audio:'audio/21.mp3', puzzle:'puzzles/21.html'},
    {id:'22', nombre:'Calle Caballeros', coords:[39.47663, -0.3773], audio:'audio/22.mp3', puzzle:'puzzles/22.html'},
    {id:'23', nombre:'Palacio de la Generalitat', coords:[39.47668, -0.37671], audio:'audio/23.mp3', puzzle:'puzzles/23.html'}
  ];

  // Variables globales para audio
  let audioActual = null;

  // Reproducir audio desde padre (parar anterior y reproducir nuevo)
  function reproducirAudio(urlAudio) {
    if(audioActual && !audioActual.paused) {
      audioActual.pause();
      // audioActual.currentTime = 0; // opcional reset al principio
    }
    audioActual = new Audio(urlAudio);
    audioActual.play();
    audioActual.onended = () => {
      console.log('Audio terminado:', urlAudio);
    };
  }

  // Abrir puzzle en ventana nueva
  function abrirPuzzle(urlPuzzle) {
    window.open(urlPuzzle, '_blank', 'width=600,height=600,scrollbars=yes,resizable=yes');
  }

  // Mostrar/Ocultar submenus con animaci√≥n
  function toggleSubmenu(id) {
    const submenu = document.getElementById(id);
    if(!submenu) return;
    if(submenu.style.display === 'block') {
      submenu.style.display = 'none';
    } else {
      // Ocultar otros submenus antes
      ['submenuHamburguesa','submenuCoordenadas','submenuRutaCompleta'].forEach(sid=>{
        if(sid !== id) document.getElementById(sid).style.display = 'none';
      });
      submenu.style.display = 'block';
    }
  }

  // Construir lista de paradas en el submenu ruta completa
  function llenarListaParadas() {
    const lista = document.getElementById('listaParadas');
    lista.innerHTML = '';
    paradas.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.id} - ${p.nombre}`;
      lista.appendChild(li);
    });
  }

  // Eventos botones flotantes
  document.getElementById('btnMapaTradicional').addEventListener('click', () => {
    document.getElementById('modalMapaTradicional').style.display = 'flex';
  });
  document.getElementById('cerrarModalMapaTradicional').addEventListener('click', () => {
    document.getElementById('modalMapaTradicional').style.display = 'none';
  });
  document.getElementById('btnHamburguesa').addEventListener('click', () => {
    toggleSubmenu('submenuHamburguesa');
  });
  document.getElementById('btnCoordenadas').addEventListener('click', () => {
    toggleSubmenu('submenuCoordenadas');
  });
  document.getElementById('btnRutaCompleta').addEventListener('click', () => {
    toggleSubmenu('submenuRutaCompleta');
  });

  // Botones dentro de submenu hamburguesa
  document.getElementById('toggleAudioBtn').addEventListener('click', () => {
    // Si audio est√° sonando, para. Si no, reproduce audio de la parada 00 por defecto.
    if(audioActual && !audioActual.paused) {
      audioActual.pause();
      audioActual = null;
      document.getElementById('toggleAudioBtn').textContent = '‚ñ∂Ô∏è Reproducir Audio';
    } else {
      reproducirAudio(paradas[0].audio);
      document.getElementById('toggleAudioBtn').textContent = '‚è∏Ô∏è Pausar Audio';
    }
  });

  document.getElementById('openPuzzleBtn').addEventListener('click', () => {
    abrirPuzzle(paradas[0].puzzle);
  });

  document.getElementById('toggleGPSBtn').addEventListener('click', () => {
    alert('Funci√≥n GPS no implementada a√∫n.');
  });

  // Comunicaci√≥n con iframe
  const iframe = document.getElementById('iframeHijo');
  window.addEventListener('message', (event) => {
    // Para seguridad, revisa event.origin si es necesario
    const data = event.data;
    if(!data || !data.tipo) return;
    switch(data.tipo) {
      case 'solicitarAudio':
        // Reproducir audio de la parada solicitada
        const paradaAudio = paradas.find(p => p.id === data.id);
        if(paradaAudio) {
          reproducirAudio(paradaAudio.audio);
        }
        break;
      case 'abrirPuzzle':
        const paradaPuzzle = paradas.find(p => p.id === data.id);
        if(paradaPuzzle) {
          abrirPuzzle(paradaPuzzle.puzzle);
        }
        break;
      case 'solicitarListaParadas':
        iframe.contentWindow.postMessage({tipo:'listaParadas', datos: paradas}, '*');
        break;
      default:
        console.log('Mensaje padre no reconocido:', data);
    }
  });

  // Llenar lista paradas al cargar p√°gina
  llenarListaParadas();
</script>

</body>
</html>
