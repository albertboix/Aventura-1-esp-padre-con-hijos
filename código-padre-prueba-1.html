<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>App Aventura - Padre</title>
<style>
  body.no-interactivo *:not(#modal-terminos):not(#modal-terminos *) {
    pointer-events: none;
    user-select: none;
  }
  body {
    margin:0; font-family: Arial, sans-serif;
  }

  /* Botones flotantes */
  .boton-flotante {
    position: fixed;
    background-color: #0078d7;
    color: white;
    border-radius: 12px;
    cursor: pointer;
    user-select: none;
    font-size: 36px;
    width: 64px;
    height: 64px;
    line-height: 64px;
    text-align: center;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .boton-flotante:hover {
    background-color: #005fa3;
  }

  /* Posiciones */
  #btn-hamburguesa { bottom: 16px; left: 16px; }
  #btn-tres-puntos { bottom: 16px; right: 16px; }
  #btn-mapa { top: 16px; right: 16px; }
  #btn-prueba-casa {
    top: 16px;
    left: 16px;
    background-color: #d32f2f;
    font-size: 20px;
    width: auto;
    padding: 0 14px;
    border-radius: 20px;
    line-height: 64px;
    user-select: none;
    z-index: 1100;
    justify-content: center;
  }

  /* Submenús */
  .submenu {
    position: fixed;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    display: none;
    z-index: 1500;
    flex-direction: column;
  }
  .submenu button {
    display: flex;
    align-items: center;
    font-size: 24px;
    padding: 16px 28px;
    border: none;
    background: none;
    width: 240px;
    cursor: pointer;
    border-bottom: 1px solid #ddd;
    color: #222;
    transition: background-color 0.3s ease;
  }
  .submenu button:last-child {
    border-bottom: none;
  }
  .submenu button:hover {
    background-color: #0078d7;
    color: white;
  }

  /* Posiciones y animaciones submenús */
  #submenu-hamburguesa {
    bottom: 88px;
    left: 16px;
    animation: slideUp 0.3s ease forwards;
  }
  #submenu-tres-puntos {
    bottom: 88px;
    right: 16px;
    animation: slideUp 0.3s ease forwards;
  }
  #submenu-mapa {
    top: 88px;
    right: 16px;
    width: 240px;
    animation: slideDown 0.3s ease forwards;
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Pestaña pantalla completa para iframes */
  #pantalla-completa {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 2000;
  }
  #iframe-contenido {
    width: 95%;
    height: 95%;
    border: none;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
  }
  #cerrar-pantalla {
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 36px;
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    user-select: none;
    z-index: 2100;
  }

  /* Modal términos y condiciones */
  #modal-terminos {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.95);
    z-index: 3000;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #modal-contenido {
    background: white;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    border-radius: 12px;
    padding: 20px;
    box-sizing: border-box;
  }
  #modal-contenido iframe {
    width: 100%;
    height: 60vh;
    border: none;
    margin-bottom: 20px;
  }
  #btn-aceptar-terminos {
    background-color: #0078d7;
    color: white;
    border: none;
    padding: 14px 24px;
    border-radius: 8px;
    font-size: 20px;
    cursor: pointer;
    user-select: none;
    display: block;
    margin: 0 auto;
  }
</style>
</head>
<body class="no-interactivo">

<!-- Botón prueba casa toggle -->
<div id="btn-prueba-casa" class="boton-flotante" title="Prueba Casa: OFF">Prueba Casa OFF</div>

<!-- Botones flotantes con íconos SVG inline -->
<div id="btn-hamburguesa" class="boton-flotante" title="Menú">
  <!-- Icono hamburguesa -->
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white" viewBox="0 0 24 24"><path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z"/></svg>
</div>

<div id="btn-tres-puntos" class="boton-flotante" title="Opciones">
  <!-- Icono tres puntos vertical -->
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="32" fill="white" viewBox="0 0 24 24">
    <circle cx="12" cy="5" r="2"/>
    <circle cx="12" cy="12" r="2"/>
    <circle cx="12" cy="19" r="2"/>
  </svg>
</div>

<div id="btn-mapa" class="boton-flotante" title="Mapa">
  <!-- Icono mapa -->
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white" viewBox="0 0 24 24">
    <path d="M20.5 3l-5.36 2.14-4.6-1.84-5.54 2.17v14.46l5.54-2.17 4.6 1.84 5.36-2.14V3zM7 18.3l-3.54 1.38V6.27l3.54-1.39v13.42zm5 .67-3.54-1.42V5.18l3.54 1.41v12.38zm6-2.38-3.54 1.42V6.35l3.54-1.42v12.37z"/>
  </svg>
</div>

<!-- Submenús -->
<div id="submenu-hamburguesa" class="submenu" style="display:none;">
  <button data-url="retos_con_puzzles_Av1_es.html">Retos y Puzzles</button>
  <button data-url="Gastronomia.html">Gastronomía</button>
  <button data-url="paginas_oficiales.html">Páginas Oficiales</button>
  <button data-url="enlaces_valencia_historica.html">València Histórica</button>
</div>

<div id="submenu-tres-puntos" class="submenu" style="display:none;">
  <button data-url="Agradecimientos.html">Agradecimientos</button>
  <button data-url="consejos_seguridad_vial.html">Consejos Seguridad Vial</button>
  <button data-url="fuentes_informacion.html">Fuentes (En desarrollo)</button>
</div>

<div id="submenu-mapa" class="submenu" style="display:none;">
  <button title="Coordenadas" data-url="Av1-coordenadas.html">&#128506; Coordenadas</button>
  <button title="Ruta completa" data-url="Av1-ruta-completa.html">&#128506; Ruta Completa</button>
  <button title="Mapa tradicional" data-url="mapas/Av1_mapa.html">&#128441; Mapa Tradicional</button>
</div>

<!-- Pestaña pantalla completa -->
<div id="pantalla-completa" style="display:none;">
  <button id="cerrar-pantalla" title="Cerrar">✕</button>
  <iframe id="iframe-contenido" src="" allow="geolocation; autoplay" allowfullscreen></iframe>
</div>

<!-- Modal términos y condiciones -->
<div id="modal-terminos" style="display:none;">
  <div id="modal-contenido">
    <iframe src="terminos_y_condiciones.html"></iframe>
    <button id="btn-aceptar-terminos">Acepto los Términos y Condiciones</button>
  </div>
</div>

<script>
  const btnHamburguesa = document.getElementById('btn-hamburguesa');
  const btnTresPuntos = document.getElementById('btn-tres-puntos');
  const btnMapa = document.getElementById('btn-mapa');
  const btnPruebaCasa = document.getElementById('btn-prueba-casa');

  const submenuHamburguesa = document.getElementById('submenu-hamburguesa');
  const submenuTresPuntos = document.getElementById('submenu-tres-puntos');
  const submenuMapa = document.getElementById('submenu-mapa');

  const pantallaCompleta = document.getElementById('pantalla-completa');
  const cerrarPantalla = document.getElementById('cerrar-pantalla');
  const iframeContenido = document.getElementById('iframe-contenido');

  const modalTerminos = document.getElementById('modal-terminos');
  const btnAceptarTerminos = document.getElementById('btn-aceptar-terminos');

  let pruebaCasaActivo = false;
  let audioPadre = null; // Aquí asignarás el audio padre, ej: document.getElementById('audioPadre')

  // Mostrar modal términos y bloquear interacción hasta aceptar
  function mostrarModalTerminos() {
    modalTerminos.style.display = 'flex';
    document.body.classList.add('no-interactivo');
  }
  // Ocultar modal términos y desbloquear interacción
  function ocultarModalTerminos() {
    modalTerminos.style.display = 'none';
    document.body.classList.remove('no-interactivo');
  }

  // Al cargar la página mostramos modal
  window.addEventListener('load', () => {
    mostrarModalTerminos();
  });
  btnAceptarTerminos.addEventListener('click', () => {
    ocultarModalTerminos();
  });

  // Función para cerrar todos los submenús con animación slideUp
  function cerrarSubmenus() {
    [submenuHamburguesa, submenuTresPuntos, submenuMapa].forEach(sub => {
      if(sub.style.display === 'flex' || sub.style.display === 'block') {
        sub.style.animation = 'slideUp 0.3s ease forwards';
        setTimeout(() => { sub.style.display = 'none'; }, 290);
      }
    });
  }

  // Función para abrir/alternar submenús con animaciones slideUp/slideDown
  function toggleSubmenu(submenu) {
    if(submenu.style.display === 'flex' || submenu.style.display === 'block') {
      cerrarSubmenus();
    } else {
      cerrarSubmenus();
      submenu.style.display = 'flex';
      if(submenu === submenuMapa) {
        submenu.style.animation = 'slideDown 0.3s ease forwards';
      } else {
        submenu.style.animation = 'slideUp 0.3s ease forwards';
      }
    }
  }

  // Eventos para botones principales flotantes
  btnHamburguesa.addEventListener('click', () => toggleSubmenu(submenuHamburguesa));
  btnTresPuntos.addEventListener('click', () => toggleSubmenu(submenuTresPuntos));
  btnMapa.addEventListener('click', () => toggleSubmenu(submenuMapa));

  // Toggle Prueba Casa con envío de mensaje iframe
  btnPruebaCasa.addEventListener('click', () => {
    pruebaCasaActivo = !pruebaCasaActivo;
    btnPruebaCasa.textContent = pruebaCasaActivo ? 'Prueba Casa ON' : 'Prueba Casa OFF';
    btnPruebaCasa.style.backgroundColor = pruebaCasaActivo ? '#388e3c' : '#d32f2f';
    btnPruebaCasa.title = pruebaCasaActivo ? 'Prueba Casa: ON' : 'Prueba Casa: OFF';

    // ----- ENVÍO MENSAJE TOGGLE PRUEBA CASA AL IFRAME -----
    enviarMensajeIframe({ tipo: 'togglePruebaCasa', activo: pruebaCasaActivo });
  });

  // Función para enviar mensajes al iframe hijo
  function enviarMensajeIframe(mensaje) {
    if (iframeContenido && iframeContenido.contentWindow) {
      iframeContenido.contentWindow.postMessage(mensaje, '*');
    }
  }

  // Función para abrir pantalla completa con iframe
  function abrirPantallaCompleta(url) {
    pantallaCompleta.style.display = 'flex';
    iframeContenido.src = url;

    // ----- PARADA AUDIO PADRE -----
    if (audioPadre && !audioPadre.paused) {
      audioPadre.pause();
      console.log("Audio padre pausado al abrir iframe.");
    }
    // ------------------------------

    // Avisar iframe para preparar audio/GPS
    enviarMensajeIframe({ tipo: 'abrirContenido', url: url });

    cerrarSubmenus();
  }

  // Función para cerrar pantalla completa y reactivar audio padre
  function cerrarPantallaCompleta() {
    pantallaCompleta.style.display = 'none';

    // Limpiar src iframe para liberar recursos y parar audio/GPS iframe
    iframeContenido.src = '';

    // ----- REANUDAR AUDIO PADRE -----
    if (audioPadre && audioPadre.paused) {
      audioPadre.play().catch(() => {
        console.log("No se pudo reanudar audio padre automáticamente.");
      });
      console.log("Audio padre reanudado tras cerrar iframe.");
    }
    // ------------------------------

    // Avisar iframe para parar audio/GPS
    enviarMensajeIframe({ tipo: 'cerrarContenido' });
  }
  cerrarPantalla.addEventListener('click', cerrarPantallaCompleta);

  // Manejar clicks en botones de submenú para abrir contenido
  function clickAbrirContenido(event) {
    const url = event.target.getAttribute('data-url');
    if(url) abrirPantallaCompleta(url);
  }
  document.querySelectorAll('.submenu button').forEach(btn => {
    btn.addEventListener('click', clickAbrirContenido);
  });

  // Escuchar mensajes desde iframe para sincronizar audio/GPS/puzzle
  window.addEventListener('message', (event) => {
    const data = event.data;
    if(!data || typeof data !== 'object') return;

    switch(data.tipo) {
      case 'audioPausado':
        console.log("Iframe indica audio pausado.");
        // Aquí podrías pausar audio padre o cambiar UI
        break;
      case 'audioReanudado':
        console.log("Iframe indica audio reanudado.");
        // Aquí podrías reanudar audio padre o cambiar UI
        break;
      case 'puzzleCompletado':
        console.log("Iframe indica puzzle completado.");
        // Aquí puedes desbloquear cosas o mostrar mensaje
        break;
      case 'gpsActualizado':
        console.log("Iframe reporta GPS actualizado:", data.posicion);
        // Puedes actualizar mapas o estados
        break;
      default:
        console.log("Mensaje iframe recibido:", data);
    }
  });

  // Ejemplo: inicializar audioPadre si tienes <audio id="audioPadre"> en HTML
  window.addEventListener('load', () => {
    audioPadre = document.getElementById('audioPadre');
  });
</script>
</body>
</html>
