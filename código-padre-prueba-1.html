<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ruta Val√®ncia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #mapa {
      height: 100%;
      width: 100%;
    }
    iframe {
      display: none;
    }
    .boton-flotante {
      position: fixed;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 50%;
      padding: 16px;
      font-size: 28px;
      z-index: 1000;
      cursor: pointer;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
    }
    #btnGPS {
      top: 10px;
      left: 10px;
      border-radius: 10px;
      font-size: 14px;
      padding: 8px 12px;
    }
    #btnHamburguesa {
      bottom: 120px;
      right: 10px;
    }
    #btnTresPuntos {
      bottom: 60px;
      right: 10px;
    }
    #btnTierra {
      bottom: 10px;
      right: 10px;
    }
    .menu-pesta√±as {
      position: fixed;
      top: 60px;
      right: 10px;
      width: 60%;
      background: white;
      color: black;
      z-index: 1001;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      gap: 12px;
    }
    .menu-pesta√±as button {
      background: #f0f0f0;
      border: 1px solid #ccc;
      padding: 10px;
      cursor: pointer;
    }
    .panel-completo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      z-index: 2000;
      display: none;
    }
    .panel-completo iframe, .panel-completo img {
      width: 99vw;
      height: 99vh;
      object-fit: contain;
    }
    .cerrar-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #00aaff;
      color: orange;
      padding: 10px;
      font-size: 20px;
      cursor: pointer;
      z-index: 2001;
    }
    #terminosOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #terminosContenido {
      background: white;
      padding: 20px;
      width: 90vw;
      height: 90vh;
      overflow: auto;
    }
    #terminosAceptar {
      margin-top: 20px;
      padding: 10px;
      background: green;
      color: white;
      font-size: 16px;
    }
    .iconos-tierra {
      position: fixed;
      bottom: 80px;
      right: 80px;
      display: none;
      flex-direction: column;
      gap: 10px;
      z-index: 1002;
    }
    .iconos-tierra button {
      font-size: 24px;
      background: white;
      border: 2px solid #007BFF;
      border-radius: 12px;
      padding: 8px;
    }
  </style>
</head>
<body>
  <div id="mapa"></div>
  <iframe id="iframeHijo" src="Av1-coordenadas.html"></iframe>

  <button id="btnGPS" class="boton-flotante">Prueba Casa OFF</button>
  <button id="btnHamburguesa" class="boton-flotante">‚ò∞</button>
  <button id="btnTresPuntos" class="boton-flotante">‚ãÆ</button>
  <button id="btnTierra" class="boton-flotante">üåç</button>

  <div id="menuHamburguesa" class="menu-pesta√±as"></div>
  <div id="menuTresPuntos" class="menu-pesta√±as"></div>
  <div id="iconosTierra" class="iconos-tierra"></div>

  <div id="panelCompleto" class="panel-completo">
    <div class="cerrar-panel" onclick="cerrarPanel()">X</div>
    <div id="contenidoPanel"></div>
  </div>

  <div id="terminosOverlay">
    <div id="terminosContenido">
      <iframe src="terminos_y_condiciones.html" style="width:100%;height:80%;border:none;"></iframe>
      <button id="terminosAceptar">Aceptar</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const mapa = L.map('mapa').setView([39.4699, -0.3763], 16);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapa);

    const iframe = document.getElementById("iframeHijo");

    let gpsCasa = false;
    const btnGPS = document.getElementById("btnGPS");
    btnGPS.onclick = () => {
      gpsCasa = !gpsCasa;
      btnGPS.textContent = gpsCasa ? "Prueba Casa ON" : "Prueba Casa OFF";
      btnGPS.style.background = gpsCasa ? "green" : "red";
    };

    const menuHamburguesa = document.getElementById("menuHamburguesa");
    const menuTresPuntos = document.getElementById("menuTresPuntos");
    const iconosTierra = document.getElementById("iconosTierra");

    document.getElementById("btnHamburguesa").onclick = () => {
      menuHamburguesa.innerHTML = "";
      [
        ["Retos y Puzzles", "retos_con_puzzles_Av1_es.html"],
        ["Gastronom√≠a", "Gastronomia.html"],
        ["P√°ginas Oficiales", "paginas_oficiales.html"],
        ["Val√®ncia Hist√≥rica", "enlaces_valencia_historica.html"]
      ].forEach(([texto, url]) => {
        const b = document.createElement("button");
        b.textContent = texto;
        b.onclick = () => abrirPanel(url);
        menuHamburguesa.appendChild(b);
      });
      menuHamburguesa.style.display = "flex";
    };

    document.getElementById("btnTresPuntos").onclick = () => {
      menuTresPuntos.innerHTML = "";
      [
        ["Agradecimientos", "Agradecimientos.html"],
        ["Consejos y Seguridad", "consejos_seguridad_vial.html"],
        ["Fuentes (en desarrollo)", ""]
      ].forEach(([texto, url]) => {
        const b = document.createElement("button");
        b.textContent = texto;
        b.onclick = () => url && abrirPanel(url);
        menuTresPuntos.appendChild(b);
      });
      menuTresPuntos.style.display = "flex";
    };

    document.getElementById("btnTierra").onclick = () => {
      iconosTierra.innerHTML = "";
      const botones = [
        ["üìç", () => gpsCasa && seleccionarSiguienteParada()],
        ["üó∫Ô∏è", () => mostrarMapaRuta()],
        ["üß≠", () => abrirPanel("mapas/Av1_mapa.jpg", true)]
      ];
      botones.forEach(([icono, accion]) => {
        const b = document.createElement("button");
        b.textContent = icono;
        b.onclick = accion;
        iconosTierra.appendChild(b);
      });
      iconosTierra.style.display = "flex";
    };

    function abrirPanel(url, esImagen = false) {
      const cont = document.getElementById("contenidoPanel");
      cont.innerHTML = esImagen ? `<img src="${url}" />` : `<iframe src="${url}"></iframe>`;
      document.getElementById("panelCompleto").style.display = "block";
      if (esImagen && screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("portrait").catch(()=>{});
      }
    }

    function cerrarPanel() {
      document.getElementById("panelCompleto").style.display = "none";
    }

    document.getElementById("terminosAceptar").onclick = () => {
      document.getElementById("terminosOverlay").style.display = "none";
    };

    function seleccionarSiguienteParada() {
      // Aqu√≠ deber√≠as abrir un mapa flotante con selecci√≥n de parada (pendiente de implementar)
      alert("Selecciona manualmente la parada (a√∫n no implementado)");
    }

    function mostrarMapaRuta() {
      // Aqu√≠ deber√≠as mostrar el mapa con paradas y ruta (pendiente de implementar)
      alert("Mostrar ruta completa (a√∫n no implementado)");
    }

    window.addEventListener("message", e => {
      if (e.data.tipo === "parada_detectada") {
        console.log("Parada detectada desde hijo:", e.data.id);
        // Aqu√≠ se puede actualizar el juego, mostrar contenido, etc.
      }
    });
  </script>
</body>
</html>
