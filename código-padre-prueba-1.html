<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aventura en Val√®ncia</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #mapa {
      height: 100%;
      width: 100%;
    }
    iframe {
      width: 0;
      height: 0;
      border: none;
      position: absolute;
      z-index: -1;
    }
    .boton-flotante {
      position: absolute;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    #hamburguesa { bottom: 20px; left: 20px; }
    #mas-opciones { bottom: 20px; right: 20px; }
    #btn-mapa { top: 20px; right: 20px; }
    #gps-prueba {
      top: 20px;
      left: 20px;
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
      background: green;
      color: white;
      z-index: 1000;
      position: absolute;
    }
    .pesta√±a-opcion {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 75%;
      background: white;
      padding: 20px;
      margin-top: 10px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 1100;
    }
    .icono-mapa {
      position: absolute;
      right: 20px;
      background: #007BFF;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      z-index: 1100;
    }
    #imagen-full {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      display: none;
      z-index: 2000;
    }
    #imagen-full img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .cerrar-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: skyblue;
      color: orange;
      font-weight: bold;
      font-size: 20px;
      padding: 5px 10px;
      border: none;
      cursor: pointer;
      z-index: 2100;
    }
  </style>
</head>
<body>
  <div id="mapa"></div>
  <iframe id="hijo" src="Av1-coordenadas.html"></iframe>

  <button id="hamburguesa" class="boton-flotante">‚ò∞</button>
  <button id="mas-opciones" class="boton-flotante">‚ãÆ</button>
  <button id="btn-mapa" class="boton-flotante">üåç</button>
  <button id="gps-prueba">Modo casa ON</button>

  <div id="imagen-full">
    <button class="cerrar-panel" onclick="cerrarImagen()">X</button>
    <img src="mapas/Av1_mapa.jpg" id="imagen-brujula" />
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const mapa = L.map('mapa').setView([39.4699, -0.3763], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(mapa);

    let gpsActivo = false;
    const botonGps = document.getElementById('gps-prueba');
    botonGps.addEventListener('click', () => {
      gpsActivo = !gpsActivo;
      botonGps.textContent = gpsActivo ? 'Modo casa OFF' : 'Modo casa ON';
      botonGps.style.background = gpsActivo ? 'red' : 'green';
      document.getElementById('hijo').contentWindow.postMessage({ tipo: 'gps_modo', activo: gpsActivo }, '*');
    });

    function mostrarImagen() {
      const panel = document.getElementById('imagen-full');
      panel.style.display = 'block';
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("portrait").catch(e => {});
      }
    }

    function cerrarImagen() {
      document.getElementById('imagen-full').style.display = 'none';
      if (screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    }

    function cerrarTodasPestanas() {
      document.querySelectorAll('.pesta√±a-opcion, .icono-mapa').forEach(el => el.remove());
    }

    function abrirPestanasDesde(boton, opciones) {
      cerrarTodasPestanas();
      opciones.forEach((url, i) => {
        const div = document.createElement('div');
        div.className = 'pesta√±a-opcion';
        div.style.top = `${100 + i * 110}px`;
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.style.width = '100%';
        iframe.style.height = '300px';
        iframe.style.border = 'none';
        div.appendChild(iframe);
        document.body.appendChild(div);
      });
    }

    document.getElementById('hamburguesa').addEventListener('click', () => {
      if (document.querySelector('.pesta√±a-opcion')) {
        cerrarTodasPestanas();
        return;
      }
      abrirPestanasDesde('hamburguesa', [
        'retos_con_puzzles_Av1_es.html',
        'Gastronomia.html',
        'paginas_oficiales.html',
        'enlaces_valencia_historica.html'
      ]);
    });

    document.getElementById('mas-opciones').addEventListener('click', () => {
      if (document.querySelector('.pesta√±a-opcion')) {
        cerrarTodasPestanas();
        return;
      }
      abrirPestanasDesde('mas-opciones', [
        'Agradecimientos.html',
        'consejos_seguridad_vial.html'
      ]);
    });

    document.getElementById('btn-mapa').addEventListener('click', () => {
      if (document.querySelector('.icono-mapa')) {
        cerrarTodasPestanas();
        return;
      }
      cerrarTodasPestanas();
      const acciones = [
        { icono: 'üìç', mensaje: 'mostrar_siguiente' },
        { icono: 'üó∫Ô∏è', mensaje: 'mostrar_ruta' },
        { icono: 'üß≠', mensaje: 'brujula' },
      ];
      acciones.forEach((accion, i) => {
        const btn = document.createElement('div');
        btn.className = 'icono-mapa';
        btn.style.top = `${80 + i * 60}px`;
        btn.innerHTML = accion.icono;
        btn.onclick = () => {
          if (accion.mensaje === 'brujula') mostrarImagen();
          else document.getElementById('hijo').contentWindow.postMessage({ tipo: accion.mensaje }, '*');
        };
        document.body.appendChild(btn);
      });
    });

    window.addEventListener('popstate', () => cerrarTodasPestanas());
  </script>
</body>
</html>
