<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa Interactivo</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #e0e0e0;
      font-family: sans-serif;
    }
    #mapa {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('mapas/Av1_mapa.jpg') no-repeat center center;
      background-size: cover;
      z-index: 1;
    }
    .boton {
      position: fixed;
      bottom: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background-color: #444;
      color: white;
      font-size: 24px;
      z-index: 100;
    }
    #btnCasa {
      top: 20px;
      left: 20px;
      width: auto;
      height: auto;
      padding: 10px;
      border-radius: 12px;
      background-color: red;
      font-size: 16px;
    }
    #btnHamburguesa { left: 20px; }
    #btnTresPuntos { right: 20px; }
    #btnTierra { right: 20px; top: 20px; position: fixed; }

    .panel-titulo {
      position: fixed;
      left: 12.5%;
      width: 75%;
      background: white;
      border-radius: 20px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 99;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .panel-titulo + .panel-titulo {
      margin-top: 20px;
    }

    .contenido-panel {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      z-index: 200;
      overflow: auto;
    }
    .cerrar-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: blue;
      color: orange;
      font-size: 24px;
      padding: 5px;
      cursor: pointer;
    }

    .opciones-tierra {
      position: fixed;
      top: 80px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    .opcion-tierra {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: blue;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    #imagenBrujulaContainer {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 500;
      background: black;
    }
    #imagenBrujula {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
      touch-action: pan-x pan-y;
    }
    #cerrarBrujula {
      position: absolute;
      top: 10px;
      right: 10px;
      background: blue;
      color: orange;
      font-size: 24px;
      padding: 5px;
      cursor: pointer;
      z-index: 600;
    }
  </style>
</head>
<body>
  <div id="mapa"></div>

  <button id="btnCasa" class="boton">Modo casa OFF</button>
  <button id="btnHamburguesa" class="boton">‚ò∞</button>
  <button id="btnTresPuntos" class="boton">‚ãÆ</button>
  <button id="btnTierra" class="boton">üåç</button>

  <div class="opciones-tierra" id="opcionesTierra" style="display:none;">
    <div class="opcion-tierra" onclick="mostrarBrujula()">üß≠</div>
    <div class="opcion-tierra" onclick="alert('Ruta completa');">üìç</div>
    <div class="opcion-tierra" onclick="alert('Siguiente punto');">‚û°Ô∏è</div>
  </div>

  <div id="paneles"></div>

  <div id="imagenBrujulaContainer" style="display:none;">
    <img id="imagenBrujula" src="mapas/Av1_mapa.jpg" alt="Br√∫jula" />
    <div id="cerrarBrujula" onclick="cerrarBrujula()">‚úñÔ∏è</div>
  </div>

  <script>
    let gpsActivo = true;

    document.getElementById("btnCasa").addEventListener("click", () => {
      gpsActivo = !gpsActivo;
      const btn = document.getElementById("btnCasa");
      if (gpsActivo) {
        btn.textContent = "Modo casa OFF";
        btn.style.backgroundColor = "red";
        console.log("GPS activado");
      } else {
        btn.textContent = "Modo casa ON";
        btn.style.backgroundColor = "green";
        console.log("GPS desactivado - modo casa activo");
      }
    });

    function mostrarPaneles(origen) {
      cerrarTodosPaneles();
      const paneles = document.getElementById("paneles");
      paneles.innerHTML = "";
      const opciones = origen === 'hamburguesa' ? [
        { titulo: "Gastronom√≠a", url: "gastronomia.html" },
        { titulo: "Retos", url: "retos.html" },
        { titulo: "P√°ginas Oficiales", url: "oficiales.html" },
        { titulo: "Valencia Historia", url: "historia.html" },
      ] : [
        { titulo: "Mapa pol√≠tico", url: "mapa.html" },
        { titulo: "Lugares clave", url: "lugares.html" },
        { titulo: "Rutas", url: "rutas.html" },
      ];

      opciones.forEach((op, idx) => {
        const div = document.createElement("div");
        div.className = "panel-titulo";
        div.style.top = `${150 + idx * 100}px`;
        div.textContent = op.titulo;
        div.addEventListener("click", () => abrirPanel(op.url));
        paneles.appendChild(div);
      });
    }

    function abrirPanel(url) {
      const cont = document.createElement("div");
      cont.className = "contenido-panel";
      const cerrar = document.createElement("div");
      cerrar.className = "cerrar-panel";
      cerrar.textContent = "‚úñÔ∏è";
      cerrar.onclick = cerrarTodosPaneles;
      const iframe = document.createElement("iframe");
      iframe.src = url;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      iframe.style.border = "none";
      cont.appendChild(cerrar);
      cont.appendChild(iframe);
      document.body.appendChild(cont);
    }

    function cerrarTodosPaneles() {
      document.getElementById("paneles").innerHTML = "";
      document.querySelectorAll(".contenido-panel").forEach(e => e.remove());
    }

    document.getElementById("btnHamburguesa").addEventListener("click", () => {
      togglePaneles('hamburguesa');
      document.getElementById("opcionesTierra").style.display = "none";
    });
    document.getElementById("btnTresPuntos").addEventListener("click", () => {
      togglePaneles('tresPuntos');
      document.getElementById("opcionesTierra").style.display = "none";
    });
    document.getElementById("btnTierra").addEventListener("click", () => {
      cerrarTodosPaneles();
      const opciones = document.getElementById("opcionesTierra");
      opciones.style.display = opciones.style.display === "none" ? "flex" : "none";
    });

    function togglePaneles(tipo) {
      if (document.getElementById("paneles").children.length > 0) {
        cerrarTodosPaneles();
      } else {
        mostrarPaneles(tipo);
      }
    }

    function mostrarBrujula() {
      document.getElementById("imagenBrujulaContainer").style.display = "block";
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("portrait").catch(console.log);
      }
    }

    function cerrarBrujula() {
      document.getElementById("imagenBrujulaContainer").style.display = "none";
      if (screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    }

    window.addEventListener("popstate", cerrarTodosPaneles);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") cerrarTodosPaneles();
    });
    window.addEventListener("backbutton", cerrarTodosPaneles);
  </script>
</body>
</html>
