<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botones y Coordenadas GPS</title>
    <style>
        body {
            margin: 0;
            padding: 5px;
            background: transparent;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 140px;
            width: 300px;
        }

        .botones-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .boton {
            width: 80px;
            height: 50px;
            border: 2px solid #333;
            border-radius: 8px;
            background: linear-gradient(135deg, #dc3545, #c82333); /* Rojo por defecto */
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .boton.activo {
            background: linear-gradient(135deg, #28a745, #1e7e34); /* Verde cuando est√° activo */
        }

        .boton:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .boton:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .boton.disabled {
            background: linear-gradient(135deg, #dc3545, #c82333);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .boton.disabled:hover {
            transform: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Control individual del tama√±o de iconos */
        .icon-gps {
            font-size: 18px; /* Tama√±o del icono GPS üõ∞Ô∏è */
        }

        .icon-imagen {
            font-size: 16px; /* Tama√±o del icono imagen üì∏ */
        }

        .icon-video {
            font-size: 17px; /* Tama√±o del icono video üìΩÔ∏è */
        }

        .status {
            margin-top: 5px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            font-size: 11px;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gps-icon {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="botones-row">
            <button id="btn-gps" class="boton">
                <span class="icon-gps">üõ∞Ô∏è<br>GPS</span>
            </button>
            <button id="btn-imagen" class="boton disabled">
                <span class="icon-imagen">üì∏<br>Foto</span>
            </button>
            <button id="btn-video" class="boton disabled">
                <span class="icon-video">üìΩÔ∏è<br>Video</span>
            </button>
        </div>
        <div id="status" class="status">
            Pulsa GPS para obtener tu ubicaci√≥n
        </div>
    </div>

    <script>
        // ================== COORDENADAS DE LAS PARADAS ==================
        const COORDENADAS_PARADAS = [
            // Parada 0 - INICIO
            { 
                tipo: "inicio", 
                nombre: "Torres de Serranos (start)", 
                lat: 39.47876, 
                lng: -0.37626 
            },
            
            // Parada 1 - TRAMO
            {
                tipo: "tramo",
                nombre: "Puente de Serranos ‚Äì Plaza de la crida",
                inicio: { lat: 39.47876, lng: -0.37626 },
                waypoints: [
                    { lat: 39.47905, lng: -0.37613 },
                    { lat: 39.47933, lng: -0.37647 },
                    { lat: 39.47943, lng: -0.37636 }
                ],
                fin: { lat: 39.47959, lng: -0.37583 }
            },
            
            // Parada 2 - TRAMO
            {
                tipo: "tramo",
                nombre: "Cortes Valencianas (Palacio de los Borgia)",
                inicio: { lat: 39.47959, lng: -0.37583 },
                waypoints: [
                    { lat: 39.47939, lng: -0.3752 },
                    { lat: 39.47902, lng: -0.37465 },
                    { lat: 39.47866, lng: -0.3747 }
                ],
                fin: { lat: 39.47785, lng: -0.37485 }
            },
            
            // Parada 3 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza de la Virgen",
                inicio: { lat: 39.47785, lng: -0.37485 },
                waypoints: [
                    { lat: 39.47768, lng: -0.3749 }
                ],
                fin: { lat: 39.47656, lng: -0.37529 }
            },
            
            // Parada 4 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza de la Almo√≠na",
                inicio: { lat: 39.47656, lng: -0.37529 },
                waypoints: [
                    { lat: 39.4766, lng: -0.37473 },
                    { lat: 39.47656, lng: -0.37453 },
                    { lat: 39.47606, lng: -0.3746 }
                ],
                fin: { lat: 39.47604, lng: -0.37451 }
            },
            
            // Parada 5 - TRAMO
            {
                tipo: "tramo",
                nombre: "Catedral de Val√®ncia",
                inicio: { lat: 39.47604, lng: -0.37451 },
                waypoints: [],
                fin: { lat: 39.47594, lng: -0.37474 }
            },
            
            // Parada 6 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza decimo Juno Bruto (Museo Arqueol√≥gico de la Almo√≠na)",
                inicio: { lat: 39.47594, lng: -0.37474 },
                waypoints: [],
                fin: { lat: 39.4762, lng: -0.37412 }
            },
            
            // Parada 7 - TRAMO
            {
                tipo: "tramo",
                nombre: "Bas√≠lica de Val√®ncia",
                inicio: { lat: 39.4762, lng: -0.37412 },
                waypoints: [],
                fin: { lat: 39.47611, lng: -0.37478 }
            },
            
            // Parada 8 - TRAMO
            {
                tipo: "tramo",
                nombre: "Palacio Arzobispal",
                inicio: { lat: 39.47611, lng: -0.37478 },
                waypoints: [
                    { lat: 39.47603, lng: -0.37433 }
                ],
                fin: { lat: 39.4755, lng: -0.37436 }
            },
            
            // Parada 9 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza del Ayuntamiento",
                inicio: { lat: 39.4755, lng: -0.37436 },
                waypoints: [
                    { lat: 39.4756, lng: -0.37466 },
                    { lat: 39.47514, lng: -0.37494 },
                    { lat: 39.47447, lng: -0.3754 },
                    { lat: 39.47378, lng: -0.3756 },
                    { lat: 39.47212, lng: -0.37676 }
                ],
                fin: { lat: 39.47056, lng: -0.37677 }
            },
            
            // Parada 10 - TRAMO
            {
                tipo: "tramo",
                nombre: "Edificio del Ayuntamiento de Val√®ncia",
                inicio: { lat: 39.47056, lng: -0.37677 },
                waypoints: [],
                fin: { lat: 39.46971, lng: -0.37693 }
            },
            
            // Parada 11 - TRAMO
            {
                tipo: "tramo",
                nombre: "Estaci√≥n de Ferrocarril (Estaci√≥n del Norte)",
                inicio: { lat: 39.46971, lng: -0.37693 },
                waypoints: [
                    { lat: 39.46795, lng: -0.37701 }
                ],
                fin: { lat: 39.46722, lng: -0.37702 }
            },
            
            // Parada 12 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza de Toros de Val√®ncia",
                inicio: { lat: 39.46722, lng: -0.37702 },
                waypoints: [],
                fin: { lat: 39.46709, lng: -0.37595 }
            },
            
            // Parada 13 - TRAMO
            {
                tipo: "tramo",
                nombre: "Casa estilo √Årabe",
                inicio: { lat: 39.46709, lng: -0.37595 },
                waypoints: [
                    { lat: 39.46714, lng: -0.37498 }
                ],
                fin: { lat: 39.46753, lng: -0.37511 }
            },
            
            // Parada 14 - TRAMO
            {
                tipo: "tramo",
                nombre: "Palacio de Comunicaciones (Correos)",
                inicio: { lat: 39.46753, lng: -0.37511 },
                waypoints: [],
                fin: { lat: 39.46942, lng: -0.37559 }
            },
            
            // Parada 15 - TRAMO
            {
                tipo: "tramo",
                nombre: "Antigua sede del Banco de Val√®ncia",
                inicio: { lat: 39.46942, lng: -0.37559 },
                waypoints: [
                    { lat: 39.4699, lng: -0.37573 },
                    { lat: 39.4703, lng: -0.3759 },
                    { lat: 39.47039, lng: -0.37505 },
                    { lat: 39.47043, lng: -0.37427 }
                ],
                fin: { lat: 39.47061, lng: -0.37408 }
            },
            
            // Parada 16 - TRAMO
            {
                tipo: "tramo",
                nombre: "Palacio del Marqu√©s de Dos Aguas (Museo Nacional de Cr√°mica)",
                inicio: { lat: 39.47061, lng: -0.37408 },
                waypoints: [
                    { lat: 39.47119, lng: -0.37423 },
                    { lat: 39.47214, lng: -0.37446 },
                    { lat: 39.47275, lng: -0.37445 }
                ],
                fin: { lat: 39.47276, lng: -0.37467 }
            },
            
            // Parada 17 - TRAMO
            {
                tipo: "tramo",
                nombre: "Mercado Central",
                inicio: { lat: 39.47276, lng: -0.37467 },
                waypoints: [
                    { lat: 39.47315, lng: -0.37608 },
                    { lat: 39.47261, lng: -0.37654 },
                    { lat: 39.47225, lng: -0.37686 },
                    { lat: 39.47265, lng: -0.37725 }
                ],
                fin: { lat: 39.47377, lng: -0.37832 }
            },
            
            // Parada 18 - TRAMO
            {
                tipo: "tramo",
                nombre: "San Juan del Mercado (Iglesia de los Santos Juanes)",
                inicio: { lat: 39.47377, lng: -0.37832 },
                waypoints: [],
                fin: { lat: 39.47425, lng: -0.37895 }
            },
            
            // Parada 19 - TRAMO
            {
                tipo: "tramo",
                nombre: "Lonja de Val√®ncia (Mercado de la Seda)",
                inicio: { lat: 39.47425, lng: -0.37895 },
                waypoints: [],
                fin: { lat: 39.47426, lng: -0.37862 }
            },
            
            // Parada 20 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza del Doctor Collado",
                inicio: { lat: 39.47426, lng: -0.37862 },
                waypoints: [
                    { lat: 39.47445, lng: -0.37889 },
                    { lat: 39.47459, lng: -0.37868 },
                    { lat: 39.47475, lng: -0.37842 },
                    { lat: 39.47436, lng: -0.37799 }
                ],
                fin: { lat: 39.47444, lng: -0.3779 }
            },
            
            // Parada 21 - TRAMO
            {
                tipo: "tramo",
                nombre: "Plaza del Negrito (Fuente del Negrito)",
                inicio: { lat: 39.47444, lng: -0.3779 },
                waypoints: [
                    { lat: 39.47473, lng: -0.37763 },
                    { lat: 39.47493, lng: -0.37761 },
                    { lat: 39.47559, lng: -0.37772 }
                ],
                fin: { lat: 39.47611, lng: -0.37741 }
            },
            
            // Parada 22 - TRAMO
            {
                tipo: "tramo",
                nombre: "Calle Caballeros",
                inicio: { lat: 39.47611, lng: -0.37741 },
                waypoints: [],
                fin: { lat: 39.47663, lng: -0.3773 }
            },
            
            // Parada 23 - TRAMO
            {
                tipo: "tramo",
                nombre: "Palacio de la Generalitat",
                inicio: { lat: 39.47663, lng: -0.3773 },
                waypoints: [
                    { lat: 39.47661, lng: -0.37685 }
                ],
                fin: { lat: 39.47668, lng: -0.37671 }
            },
            
            // Parada 24 - TRAMO (final)
            {
                tipo: "tramo",
                nombre: "Calle de los Serranos (end)",
                inicio: { lat: 39.47668, lng: -0.37671 },
                waypoints: [
                    { lat: 39.47661, lng: -0.37685 },
                    { lat: 39.47687, lng: -0.37686 }
                ],
                fin: { lat: 39.47773, lng: -0.37671 }
            }
        ];

        // Variables globales
        let ubicacionActual = null;
        let paradaActual = 0;
        let watchId = null;
        let modoCasa = false;

        // Referencias a elementos DOM
        const btnGps = document.getElementById('btn-gps');
        const btnImagen = document.getElementById('btn-imagen');
        const btnVideo = document.getElementById('btn-video');
        const status = document.getElementById('status');

        // Configuraci√≥n de im√°genes y videos por parada
        const IMAGENES_PARADAS = [
            'img/parada_0.jpg',   // 0. Torres de Serranos (start)
            'img/parada_1.jpg',   // 1. Puente de Serranos ‚Äì Plaza de la crida
            'img/parada_2.jpg',   // 2. Cortes Valencianas (Palacio de los Borgia)
            'img/parada_3.jpg',   // 3. Plaza de la Virgen
            'img/parada_4.jpg',   // 4. Plaza de la Almo√≠na
            'img/parada_5.jpg',   // 5. Catedral de Val√®ncia
            'img/parada_6.jpg',   // 6. Plaza decimo Juno Bruto (Museo Arqueol√≥gico de la Almo√≠na)
            'img/parada_7.jpg',   // 7. Bas√≠lica de Val√®ncia
            'img/parada_8.jpg',   // 8. Palacio Arzobispal
            'img/parada_9.jpg',   // 9. Plaza del Ayuntamiento
            'img/parada_10.jpg',  // 10. Edificio del Ayuntamiento de Val√®ncia
            'img/parada_11.jpg',  // 11. Estaci√≥n de Ferrocarril (Estaci√≥n del Norte)
            'img/parada_12.jpg',  // 12. Plaza de Toros de Val√®ncia
            'img/parada_13.jpg',  // 13. Casa estilo √Årabe
            'img/parada_14.jpg',  // 14. Palacio de Comunicaciones (Correos)
            'img/parada_15.jpg',  // 15. Antigua sede del Banco de Val√®ncia
            'img/parada_16.jpg',  // 16. Palacio del Marqu√©s de Dos Aguas (Museo Nacional de Cr√°mica)
            'img/parada_17.jpg',  // 17. Mercado Central
            'img/parada_18.jpg',  // 18. San Juan del Mercado (Iglesia de los Santos Juanes)
            'img/parada_19.jpg',  // 19. Lonja de Val√®ncia (Mercado de la Seda)
            'img/parada_20.jpg',  // 20. Plaza del Doctor Collado
            'img/parada_21.jpg',  // 21. Plaza del Negrito (Fuente del Negrito)
            'img/parada_22.jpg',  // 22. Calle Caballeros
            'img/parada_23.jpg',  // 23. Palacio de la Generalitat
            'img/parada_24.jpg'   // 24. Calle de los Serranos (end)
        ];

        const VIDEOS_PARADAS = [
            'videos/parada_0.mp4',   // 0. Torres de Serranos (start)
            'videos/parada_1.mp4',   // 1. Puente de Serranos ‚Äì Plaza de la crida
            'videos/parada_2.mp4',   // 2. Cortes Valencianas (Palacio de los Borgia)
            'videos/parada_3.mp4',   // 3. Plaza de la Virgen
            'videos/parada_4.mp4',   // 4. Plaza de la Almo√≠na
            'videos/parada_5.mp4',   // 5. Catedral de Val√®ncia
            'videos/parada_6.mp4',   // 6. Plaza decimo Juno Bruto (Museo Arqueol√≥gico de la Almo√≠na)
            'videos/parada_7.mp4',   // 7. Bas√≠lica de Val√®ncia
            'videos/parada_8.mp4',   // 8. Palacio Arzobispal
            'videos/parada_9.mp4',   // 9. Plaza del Ayuntamiento
            'videos/parada_10.mp4',  // 10. Edificio del Ayuntamiento de Val√®ncia
            'videos/parada_11.mp4',  // 11. Estaci√≥n de Ferrocarril (Estaci√≥n del Norte)
            'videos/parada_12.mp4',  // 12. Plaza de Toros de Val√®ncia
            'videos/parada_13.mp4',  // 13. Casa estilo √Årabe
            'videos/parada_14.mp4',  // 14. Palacio de Comunicaciones (Correos)
            'videos/parada_15.mp4',  // 15. Antigua sede del Banco de Val√®ncia
            'videos/parada_16.mp4',  // 16. Palacio del Marqu√©s de Dos Aguas (Museo Nacional de Cr√°mica)
            'videos/parada_17.mp4',  // 17. Mercado Central
            'videos/parada_18.mp4',  // 18. San Juan del Mercado (Iglesia de los Santos Juanes)
            'videos/parada_19.mp4',  // 19. Lonja de Val√®ncia (Mercado de la Seda)
            'videos/parada_20.mp4',  // 20. Plaza del Doctor Collado
            'videos/parada_21.mp4',  // 21. Plaza del Negrito (Fuente del Negrito)
            'videos/parada_22.mp4',  // 22. Calle Caballeros
            'videos/parada_23.mp4',  // 23. Palacio de la Generalitat
            'videos/parada_24.mp4'   // 24. Calle de los Serranos (end)
        ];

        // ================== FUNCIONES DE UTILIDAD ==================
        function calcularDistancia(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Radio de la Tierra en metros
            const œÜ1 = lat1 * Math.PI/180;
            const œÜ2 = lat2 * Math.PI/180;
            const ŒîœÜ = (lat2-lat1) * Math.PI/180;
            const ŒîŒª = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                    Math.cos(œÜ1) * Math.cos(œÜ2) *
                    Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c; // Distancia en metros
        }

        function actualizarStatus(mensaje, loading = false) {
            status.textContent = mensaje;
            if (loading) {
                status.classList.add('loading');
            } else {
                status.classList.remove('loading');
            }
        }

        function activarBoton(boton) {
            boton.classList.remove('disabled');
            boton.classList.add('activo');
        }

        function desactivarBoton(boton) {
            boton.classList.add('disabled');
            boton.classList.remove('activo');
        }

        function activarTodosBotones() {
            activarBoton(btnGps);
            activarBoton(btnImagen);
            activarBoton(btnVideo);
        }

        function desactivarTodosBotones() {
            desactivarBoton(btnGps);
            desactivarBoton(btnImagen);
            desactivarBoton(btnVideo);
        }

        // ================== FUNCIONES GPS ==================
        function iniciarGPS() {
            if (!navigator.geolocation) {
                actualizarStatus('GPS no disponible en este dispositivo');
                return;
            }

            actualizarStatus('Obteniendo ubicaci√≥n GPS...', true);

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            };

            // Obtener ubicaci√≥n inicial
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    ubicacionActual = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    // Enviar ubicaci√≥n al padre
                    enviarMensajeAlPadre({
                        type: 'actualizarUbicacionMapa',
                        lat: ubicacionActual.lat,
                        lng: ubicacionActual.lng
                    });

                    actualizarStatus(`GPS activo - Precisi√≥n: ${Math.round(position.coords.accuracy)}m`);
                    verificarLlegadaAParada();
                },
                (error) => {
                    console.error('Error GPS:', error);
                    actualizarStatus('Error al obtener ubicaci√≥n GPS');
                },
                options
            );

            // Comenzar seguimiento continuo
            watchId = navigator.geolocation.watchPosition(
                (position) => {
                    ubicacionActual = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    // Enviar ubicaci√≥n actualizada al padre
                    enviarMensajeAlPadre({
                        type: 'actualizarUbicacionMapa',
                        lat: ubicacionActual.lat,
                        lng: ubicacionActual.lng
                    });

                    verificarLlegadaAParada();
                },
                (error) => {
                    console.error('Error GPS tracking:', error);
                },
                options
            );
        }

        function detenerGPS() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            ubicacionActual = null;
            actualizarStatus('GPS desactivado');
        }

        function verificarLlegadaAParada() {
            if (!ubicacionActual || paradaActual >= COORDENADAS_PARADAS.length) return;

            const paradaDestino = COORDENADAS_PARADAS[paradaActual];
            const distancia = calcularDistancia(
                ubicacionActual.lat, ubicacionActual.lng,
                paradaDestino.lat, paradaDestino.lng
            );

            const RADIO_LLEGADA = 50; // 50 metros de radio

            if (distancia <= RADIO_LLEGADA) {
                actualizarStatus(`¬°Has llegado a la parada ${paradaActual + 1}!`);
                activarTodosBotones();
                
                // Notificar al padre que hemos llegado
                enviarMensajeAlPadre({
                    tipo: 'ya-estoy-aqui',
                    parada: paradaActual
                });
            } else {
                actualizarStatus(`Distancia a parada ${paradaActual + 1}: ${Math.round(distancia)}m`);
            }
        }

        // ================== FUNCIONES DE NAVEGACI√ìN ==================
        async function obtenerRuta(origen, destino) {
            try {
                // Simular obtenci√≥n de ruta (en una implementaci√≥n real usar√≠as una API de routing)
                return [
                    { lat: origen.lat, lng: origen.lng },
                    { lat: destino.lat, lng: destino.lng }
                ];
            } catch (error) {
                console.error('Error obteniendo ruta:', error);
                return null;
            }
        }

        async function navegarDeAB(origenIndex, destinoIndex) {
            if (!ubicacionActual) {
                actualizarStatus('Necesitas activar GPS primero');
                return;
            }

            const origen = origenIndex !== undefined ? COORDENADAS_PARADAS[origenIndex] : ubicacionActual;
            const destino = COORDENADAS_PARADAS[destinoIndex];

            if (!destino) {
                console.error('Destino no v√°lido');
                return;
            }

            actualizarStatus('Calculando ruta...', true);
            
            const ruta = await obtenerRuta(origen, destino);
            
            if (ruta) {
                enviarMensajeAlPadre({
                    tipo: 'mostrar-mapa-gps',
                    ruta: ruta,
                    origen: origen,
                    destino: destino
                });
                
                paradaActual = destinoIndex;
                actualizarStatus(`Navegando a parada ${destinoIndex + 1}`);
            } else {
                actualizarStatus('Error calculando ruta');
            }
        }

        // ================== EVENTOS DE BOTONES ==================
        btnGps.addEventListener('click', () => {
            if (btnGps.classList.contains('disabled')) return;
            
            // Bot√≥n 1: GPS - Navegaci√≥n de punto A a punto B
            const paradaDestino = COORDENADAS_PARADAS[paradaActual];
            
            if (paradaDestino) {
                actualizarStatus(`Navegando a parada ${paradaActual + 1}...`);
                
                // Enviar mensaje al padre para mostrar navegaci√≥n GPS
                enviarMensajeAlPadre({
                    tipo: 'mostrar-navegacion-gps',
                    paradaActual: paradaActual,
                    coordenadasDestino: paradaDestino,
                    ubicacionUsuario: ubicacionActual
                });
            }
        });

        btnImagen.addEventListener('click', () => {
            if (btnImagen.classList.contains('disabled')) return;
            
            // Bot√≥n 2: Mostrar imagen de la parada actual
            const imagenSrc = IMAGENES_PARADAS[paradaActual];
            
            if (imagenSrc) {
                actualizarStatus(`Mostrando imagen de parada ${paradaActual + 1}`);
                
                enviarMensajeAlPadre({
                    tipo: 'mostrar-imagen',
                    parada: paradaActual + 1,
                    imagenSrc: imagenSrc
                });
            }
        });

        btnVideo.addEventListener('click', () => {
            if (btnVideo.classList.contains('disabled')) return;
            
            // Bot√≥n 3: Zoom-in 2 segundos y luego mostrar video
            const videoSrc = VIDEOS_PARADAS[paradaActual];
            const coordenadas = COORDENADAS_PARADAS[paradaActual];
            
            if (videoSrc && coordenadas) {
                actualizarStatus(`Preparando video de parada ${paradaActual + 1}...`);
                
                // Primero hacer zoom-in por 2 segundos
                enviarMensajeAlPadre({
                    tipo: 'mostrar-zoom-coordenadas',
                    coordenadas: coordenadas,
                    parada: paradaActual + 1
                });
                
                // Despu√©s de 2 segundos, mostrar el video con autoplay
                setTimeout(() => {
                    enviarMensajeAlPadre({
                        tipo: 'mostrar-video',
                        parada: paradaActual + 1,
                        videoSrc: videoSrc,
                        autoplay: true
                    });
                    
                    actualizarStatus(`Reproduciendo video de parada ${paradaActual + 1}`);
                }, 2000);
            }
        });

        // ================== COMUNICACI√ìN CON EL PADRE ==================
        function enviarMensajeAlPadre(mensaje) {
            window.parent.postMessage(mensaje, '*');
        }

        // Escuchar mensajes del padre
        window.addEventListener('message', (event) => {
            const data = event.data;
            
            // El padre nos dice en qu√© parada estamos
            if (data && data.tipo === 'actualizar-parada-actual') {
                paradaActual = data.parada;
                actualizarStatus(`Parada actual: ${paradaActual + 1}`);
            }
            
            // El padre activa el bot√≥n GPS (rojo ‚Üí verde)
            if (data && data.tipo === 'activar-boton-gps') {
                activarBoton(btnGps);
                actualizarStatus('GPS activado - Listo para navegar');
            }
            
            // El padre activa el bot√≥n de imagen (rojo ‚Üí verde)
            if (data && data.tipo === 'activar-boton-imagen') {
                activarBoton(btnImagen);
                actualizarStatus('Bot√≥n imagen activado');
            }
            
            // El padre activa el bot√≥n de video (rojo ‚Üí verde)
            if (data && data.tipo === 'activar-boton-video') {
                activarBoton(btnVideo);
                actualizarStatus('Bot√≥n video activado');
            }
            
            // El padre activa todos los botones
            if (data && data.tipo === 'activar-todos-botones') {
                activarTodosBotones();
                actualizarStatus('Todos los botones activados');
            }
            
            // El padre desactiva todos los botones
            if (data && data.tipo === 'desactivar-todos-botones') {
                desactivarTodosBotones();
                actualizarStatus('Esperando activaci√≥n...');
            }
            
            // Actualizar ubicaci√≥n del usuario
            if (data && data.tipo === 'actualizar-ubicacion-usuario') {
                ubicacionActual = {
                    lat: data.lat,
                    lng: data.lng
                };
            }
        });

        // ================== INICIALIZACI√ìN ==================
        document.addEventListener('DOMContentLoaded', () => {
            // Todos los botones empiezan desactivados (fondo rojo)
            desactivarTodosBotones();
            actualizarStatus('Esperando instrucciones del padre...');
        });
    </script>
</body>
</html>
